<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Career Coach - Your Personal Career Development Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        .result-area {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .voice-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .voice-btn:hover {
            background: #218838;
            transform: scale(1.05);
        }

        .voice-btn.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .payment-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .plan-card {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-card:hover {
            border-color: #667eea;
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
        }

        .plan-card.featured {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
        }

        .plan-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .plan-duration {
            color: #666;
            margin-bottom: 20px;
        }

        .plan-features {
            list-style: none;
            margin-bottom: 25px;
        }

        .plan-features li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .plan-features li:last-child {
            border-bottom: none;
        }

        .select-plan-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }

        .select-plan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .mobile-voice-fallback {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .mobile-text-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .send-mobile-text-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .voice-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .voice-btn {
                justify-content: center;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-section {
            margin-top: 20px;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 8px;
            border: 1px solid #c3e6c3;
        }

        .download-section h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .download-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .download-btn:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI Career Coach</h1>
            <p>Your Personal AI-Powered Career Development Assistant</p>
        </div>

        <div class="main-content">
            <!-- AI Career Chat -->
            <div class="card">
                <h2>💬 AI Career Chat</h2>
                <div class="input-group">
                    <label for="chatInput">Ask me anything about your career:</label>
                    <textarea id="chatInput" placeholder="e.g., How can I improve my resume? What skills should I learn for data science?"></textarea>
                </div>
                
                <div class="voice-controls">
                    <button id="voiceInputBtn" class="voice-btn">
                        🎤 Start Voice Input
                    </button>
                    <button id="voiceStopBtn" class="voice-btn" style="display: none;">
                        ⏹️ Stop Recording
                    </button>
                </div>

                <div id="mobileVoiceFallback" class="mobile-voice-fallback">
                    <p>Voice input not working? Use text instead:</p>
                    <input type="text" id="mobileTextInput" class="mobile-text-input" placeholder="Type your message here...">
                    <button onclick="sendMobileTextInput()" class="send-mobile-text-btn">Send</button>
                </div>

                <button onclick="sendChatMessage()" class="btn">Send Message</button>
                <div id="chatResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Resume Analysis & Optimization -->
            <div class="card">
                <h2>📄 Resume Analysis & Optimization</h2>
                <div class="input-group">
                    <label for="resumeInput">Paste your resume:</label>
                    <textarea id="resumeInput" placeholder="Paste your resume content here..."></textarea>
                </div>
                <div class="input-group">
                    <label for="jobDescriptionInput">Job Description (for optimization):</label>
                    <textarea id="jobDescriptionInput" placeholder="Paste the job description to optimize your resume..."></textarea>
                </div>
                <button onclick="analyzeResume()" class="btn">Analyze Resume</button>
                <button onclick="optimizeResume()" class="btn btn-success">Optimize for Role</button>
                <div id="resumeResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Cover Letter Generation -->
            <div class="card">
                <h2>✉️ Cover Letter Generation</h2>
                <div class="input-group">
                    <label for="coverLetterResume">Your Resume:</label>
                    <textarea id="coverLetterResume" placeholder="Paste your resume here..."></textarea>
                </div>
                <div class="input-group">
                    <label for="coverLetterJob">Job Description:</label>
                    <textarea id="coverLetterJob" placeholder="Paste the job description here..."></textarea>
                </div>
                <button onclick="generateCoverLetter()" class="btn">Generate Cover Letter</button>
                <div id="coverLetterResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Interview Preparation -->
            <div class="card">
                <h2>🎯 Interview Preparation</h2>
                <div class="input-group">
                    <label for="interviewRole">Target Role:</label>
                    <input type="text" id="interviewRole" placeholder="e.g., Software Engineer, Data Scientist">
                </div>
                <button onclick="prepareInterview()" class="btn">Get Interview Questions</button>
                <div id="interviewResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Career Planning -->
            <div class="card">
                <h2>🚀 Career Planning</h2>
                <div class="input-group">
                    <label for="currentRole">Current Role:</label>
                    <input type="text" id="currentRole" placeholder="e.g., Junior Developer">
                </div>
                <div class="input-group">
                    <label for="targetRole">Target Role:</label>
                    <input type="text" id="targetRole" placeholder="e.g., Senior Developer">
                </div>
                <div class="input-group">
                    <label for="experienceYears">Years of Experience:</label>
                    <input type="number" id="experienceYears" placeholder="e.g., 3" min="0" max="50">
                </div>
                <button onclick="planCareer()" class="btn">Create Career Plan</button>
                <div id="careerResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Job Market Analytics -->
            <div class="card">
                <h2>📊 Job Market Analytics</h2>
                <button onclick="getJobAnalytics()" class="btn">Get Real-Time Analytics</button>
                <div id="analyticsResult" class="result-area" style="display: none;"></div>
            </div>

            <!-- Job Search -->
            <div class="card">
                <h2>🔍 Job Search</h2>
                <div class="input-group">
                    <label for="jobQuery">Job Title/Keywords:</label>
                    <input type="text" id="jobQuery" placeholder="e.g., Python Developer, Data Analyst">
                </div>
                <div class="input-group">
                    <label for="jobLocation">Location:</label>
                    <input type="text" id="jobLocation" placeholder="e.g., Remote, New York, CA">
                </div>
                <button onclick="searchJobs()" class="btn">Search Jobs</button>
                <div id="jobSearchResult" class="result-area" style="display: none;"></div>
            </div>
        </div>

        <!-- Payment Plans -->
        <div class="payment-section">
            <h2>💳 Choose Your Plan</h2>
            <div class="plans-grid" id="plansGrid">
                <!-- Plans will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let recognition = null;
        let isRecording = false;
        let currentUserId = 'user_' + Date.now();

        // Initialize mobile features
        function initializeMobileFeatures() {
            if (isMobileDevice()) {
                document.getElementById('voiceInputBtn').textContent = '🎤 Mobile Voice Input';
                // Show mobile-specific messages
                console.log('Mobile device detected - voice features optimized');
            }
        }

        // Check if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Initialize speech recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                
                if (isMobileDevice()) {
                    // Mobile-specific settings
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;
                    recognition.lang = 'en-US';
                    recognition.timeout = 8000; // Shorter timeout for mobile
                } else {
                    // Desktop settings
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    recognition.maxAlternatives = 1;
                    recognition.lang = 'en-US';
                    recognition.timeout = 10000;
                }

                recognition.onstart = function() {
                    isRecording = true;
                    document.getElementById('voiceInputBtn').classList.add('recording');
                    document.getElementById('voiceInputBtn').textContent = '🔴 Recording...';
                    document.getElementById('voiceStopBtn').style.display = 'inline-block';
                };

                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    document.getElementById('chatInput').value = transcript;
                    stopVoiceInput();
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    let errorMessage = 'Voice recognition error occurred.';
                    
                    if (isMobileDevice()) {
                        switch(event.error) {
                            case 'no-speech':
                                errorMessage = 'No speech detected. Please try again or use text input.';
                                showMobileVoiceFallback();
                                break;
                            case 'audio-capture':
                                errorMessage = 'Microphone access denied. Please check permissions.';
                                showMobileVoiceFallback();
                                break;
                            case 'not-allowed':
                                errorMessage = 'Microphone access denied. Please allow microphone access.';
                                showMobileVoiceFallback();
                                break;
                            case 'service-not-allowed':
                                errorMessage = 'Voice service not available. Please use text input.';
                                showMobileVoiceFallback();
                                break;
                            case 'bad-grammar':
                                errorMessage = 'Voice recognition failed. Please use text input.';
                                showMobileVoiceFallback();
                                break;
                            default:
                                errorMessage = 'Voice recognition error. Please use text input.';
                                showMobileVoiceFallback();
                        }
                    }
                    
                    alert(errorMessage);
                    stopVoiceInput();
                };

                recognition.onend = function() {
                    stopVoiceInput();
                };
            } else {
                alert('Speech recognition not supported in this browser. Please use text input.');
            }
        }

        // Start voice input
        function startVoiceInput() {
            if (!recognition) {
                initializeSpeechRecognition();
            }
            
            if (recognition && !isRecording) {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting voice recognition:', error);
                    if (isMobileDevice()) {
                        showMobileVoiceFallback();
                    }
                }
            }
        }

        // Stop voice input
        function stopVoiceInput() {
            if (recognition && isRecording) {
                recognition.stop();
                recognition.abort(); // Force stop, especially for mobile
            }
            
            isRecording = false;
            document.getElementById('voiceInputBtn').classList.remove('recording');
            document.getElementById('voiceInputBtn').textContent = isMobileDevice() ? '🎤 Mobile Voice Input' : '🎤 Start Voice Input';
            document.getElementById('voiceStopBtn').style.display = 'none';
        }

        // Show mobile voice fallback
        function showMobileVoiceFallback() {
            document.getElementById('mobileVoiceFallback').style.display = 'block';
        }

        // Send mobile text input
        function sendMobileTextInput() {
            const text = document.getElementById('mobileTextInput').value.trim();
            if (text) {
                document.getElementById('chatInput').value = text;
                document.getElementById('mobileTextInput').value = '';
                document.getElementById('mobileVoiceFallback').style.display = 'none';
                sendChatMessage();
            }
        }

        // Send chat message
        async function sendChatMessage() {
            const message = document.getElementById('chatInput').value.trim();
            if (!message) return;

            const resultDiv = document.getElementById('chatResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Processing...';

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `AI Response:\n\n${data.response}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Analyze resume
        async function analyzeResume() {
            const resume = document.getElementById('resumeInput').value.trim();
            if (!resume) return;

            const resultDiv = document.getElementById('resumeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Analyzing resume...';

            try {
                const response = await fetch('/api/resume-analysis', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ resume, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Resume Analysis:\n\n${data.analysis}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Optimize resume
        async function optimizeResume() {
            const resume = document.getElementById('resumeInput').value.trim();
            const jobDescription = document.getElementById('jobDescriptionInput').value.trim();
            
            if (!resume || !jobDescription) {
                alert('Please provide both resume and job description for optimization.');
                return;
            }

            const resultDiv = document.getElementById('resumeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Optimizing resume...';

            try {
                const response = await fetch('/api/update-resume', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ resume, jobDescription, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Optimized Resume:\n\n${data.optimizedResume}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                    
                    // Add download options
                    addDownloadOptions(resultDiv, data.optimizedResume, 'Optimized Resume', 'resume');
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Generate cover letter
        async function generateCoverLetter() {
            const resume = document.getElementById('coverLetterResume').value.trim();
            const jobDescription = document.getElementById('coverLetterJob').value.trim();
            
            if (!resume || !jobDescription) {
                alert('Please provide both resume and job description.');
                return;
            }

            const resultDiv = document.getElementById('coverLetterResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Generating cover letter...';

            try {
                const response = await fetch('/api/cover-letter', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ resume, jobDescription, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Generated Cover Letter:\n\n${data.coverLetter}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                    
                    // Add download options
                    addDownloadOptions(resultDiv, data.coverLetter, 'Cover Letter', 'coverLetter');
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Prepare interview
        async function prepareInterview() {
            const role = document.getElementById('interviewRole').value.trim();
            if (!role) return;

            const resultDiv = document.getElementById('interviewResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Preparing interview questions...';

            try {
                const response = await fetch('/api/interview-prep', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ role, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Interview Preparation:\n\n${data.questions}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Plan career
        async function planCareer() {
            const currentRole = document.getElementById('currentRole').value.trim();
            const targetRole = document.getElementById('targetRole').value.trim();
            const experience = document.getElementById('experienceYears').value;
            
            if (!currentRole || !targetRole || !experience) {
                alert('Please fill in all fields for career planning.');
                return;
            }

            const resultDiv = document.getElementById('careerResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Creating career plan...';

            try {
                const response = await fetch('/api/career-planning', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentRole, targetRole, experience, userId: currentUserId })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Career Development Plan:\n\n${data.plan}\n\nUsage: ${JSON.stringify(data.usage, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Get job analytics
        async function getJobAnalytics() {
            const resultDiv = document.getElementById('analyticsResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Fetching real-time analytics...';

            try {
                const response = await fetch('/api/job-analytics', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    resultDiv.innerHTML = `Real-Time Job Market Analytics:\n\n` +
                        `Total Jobs Available: ${data.totalJobs}\n` +
                        `Remote Jobs: ${data.remoteJobs}\n` +
                        `Average Salary: $${data.avgSalary.toLocaleString()}\n` +
                        `Top Skills in Demand: ${data.topSkills.join(', ')}\n` +
                        `Market Trend: ${data.marketTrend}\n` +
                        `Last Updated: ${data.lastUpdated}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Search jobs
        async function searchJobs() {
            const query = document.getElementById('jobQuery').value.trim();
            const location = document.getElementById('jobLocation').value.trim();
            
            if (!query) {
                alert('Please enter a job title or keywords to search.');
                return;
            }

            const resultDiv = document.getElementById('jobSearchResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading"></div> Searching for jobs...';

            try {
                const response = await fetch('/api/job-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query, location })
                });

                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = `Error: ${data.error}`;
                } else {
                    let resultsHtml = 'Job Search Results:\n\n';
                    data.results.forEach((job, index) => {
                        resultsHtml += `${index + 1}. ${job.title}\n` +
                            `   Company: ${job.company}\n` +
                            `   Location: ${job.location}\n` +
                            `   Salary: ${job.salary}\n` +
                            `   Posted: ${job.posted}\n` +
                            `   Description: ${job.description}\n\n`;
                    });
                    
                    resultDiv.innerHTML = resultsHtml;
                }
            } catch (error) {
                resultDiv.innerHTML = `Error: ${error.message}`;
            }
        }

        // Add download options
        function addDownloadOptions(resultDiv, content, title, type) {
            const downloadSection = document.createElement('div');
            downloadSection.className = 'download-section';
            downloadSection.innerHTML = `
                <h4>📥 Download Options</h4>
                <button onclick="downloadAsWord('${content.replace(/'/g, "\\'")}', '${title}')" class="download-btn">
                    Download as Word Doc
                </button>
            `;
            
            if (type === 'coverLetter') {
                downloadSection.innerHTML += `
                    <button onclick="downloadCoverLetterWord('${content.replace(/'/g, "\\'")}', '${title}')" class="download-btn">
                        Download Cover Letter as Word
                    </button>
                `;
            }
            
            resultDiv.appendChild(downloadSection);
        }

        // Download as Word document
        async function downloadAsWord(content, title) {
            try {
                const response = await fetch('/api/download-word', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, title })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${title}.docx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('Failed to download document');
                }
            } catch (error) {
                alert('Error downloading document: ' + error.message);
            }
        }

        // Download cover letter as Word
        async function downloadCoverLetterWord(content, title) {
            try {
                const response = await fetch('/api/download-cover-letter-word', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, title })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Cover_Letter.docx';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('Failed to download cover letter');
                }
            } catch (error) {
                alert('Error downloading cover letter: ' + error.message);
            }
        }

        // Load payment plans
        async function loadPaymentPlans() {
            try {
                const response = await fetch('/api/payment-plans');
                const plans = await response.json();
                
                const plansGrid = document.getElementById('plansGrid');
                plansGrid.innerHTML = '';
                
                Object.entries(plans).forEach(([key, plan]) => {
                    const planCard = document.createElement('div');
                    planCard.className = `plan-card ${key === 'starter' ? 'featured' : ''}`;
                    
                    planCard.innerHTML = `
                        <div class="plan-name">${plan.name}</div>
                        <div class="plan-price">${plan.price}</div>
                        <div class="plan-duration">${plan.duration}</div>
                        <ul class="plan-features">
                            ${plan.features.map(feature => `<li>✓ ${feature}</li>`).join('')}
                        </ul>
                        <button onclick="selectPlan('${key}')" class="select-plan-btn">
                            ${key === 'free' ? 'Start Free Trial' : 'Select Plan'}
                        </button>
                    `;
                    
                    plansGrid.appendChild(planCard);
                });
            } catch (error) {
                console.error('Error loading payment plans:', error);
            }
        }

        // Select payment plan
        async function selectPlan(planName) {
            try {
                const response = await fetch('/api/process-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: currentUserId, planName })
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(result.message);
                    // Refresh the page to show updated usage
                    location.reload();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                alert('Error processing payment: ' + error.message);
            }
        }

        // Event listeners
        document.getElementById('voiceInputBtn').addEventListener('click', startVoiceInput);
        document.getElementById('voiceStopBtn').addEventListener('click', stopVoiceInput);

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeMobileFeatures();
            loadPaymentPlans();
        });
    </script>
</body>
</html>
