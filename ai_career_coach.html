<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AI Career Coach - Your Personal Career Assistant</title>
    <style>
        /* Authentication Styles */
        .auth-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .auth-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .auth-container h2 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        
        .auth-container p {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 30px;
        }
        
        .auth-form {
            text-align: left;
        }
        
        .auth-form h3 {
            color: #64b5f6;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        
        .auth-form input:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.3);
        }
        
        .auth-form input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-form button:hover {
            background: linear-gradient(45deg, #42a5f5, #2196f3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.4);
        }
        
        .auth-form p {
            text-align: center;
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .auth-form a {
            color: #64b5f6;
            text-decoration: none;
            font-weight: bold;
        }
        
        .auth-form a:hover {
            text-decoration: underline;
            color: #42a5f5;
        }
        
        /* Main App Styles */
        .main-app {
            min-height: 100vh;
            background: transparent;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-info span {
            color: #ffffff;
            font-weight: 500;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Ensure all text is visible on dark background */
        * {
            color: inherit;
        }
        
        /* Override specific elements that need different colors */
        .tab.active, .btn, .notification.success {
            color: #ffffff !important;
        }
        
        .section h3, .auth-form h3, .resume-section h4, .cover-letter-section h4 {
            color: #64b5f6 !important;
        }
        
        /* Ensure tabs are clearly visible */
        .tab {
            color: #ffffff !important;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }
        
        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2) !important;
            color: #ffffff !important;
        }
        
        /* Ensure all content areas have proper contrast */
        .tab-content, .section, .result-area {
            color: #ffffff !important;
        }
        
        /* Enhanced Analytics Section Styling */
        .analytics-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .analytics-section h4 {
            color: #64b5f6 !important;
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #64b5f6;
            padding-bottom: 10px;
        }
        
        .analytics-section p {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        
        .analytics-section .input-group {
            margin-bottom: 20px;
        }
        
        .analytics-section .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #64b5f6;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .analytics-section .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .analytics-section .input-group input:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 10000;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .notification.error {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .notification.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .notification.warning {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .analytics-section .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .analytics-section .btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            font-weight: 600;
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .analytics-section .btn:hover {
            background: linear-gradient(45deg, #42a5f5, #2196f3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.4);
        }
        
        /* Job Analytics Results Styling */
        .job-analytics {
            margin-top: 20px;
        }
        
        .analytics-section-result {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .analytics-section-result h4 {
            color: #64b5f6 !important;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 1px solid rgba(100, 181, 246, 0.3);
            padding-bottom: 8px;
        }
        
        .analytics-grid, .skills-grid, .opportunities-grid, .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .analytics-card, .skills-category, .opportunity-card, .advice-category {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 18px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .analytics-card:hover, .skills-category:hover, .opportunity-card:hover, .advice-category:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .analytics-card h5, .skills-category h5, .opportunity-card h5, .advice-category h5 {
            color: #64b5f6 !important;
            margin-bottom: 12px;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .analytics-card ul, .skills-category ul, .advice-category ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .analytics-card li, .skills-category li, .advice-category li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .analytics-card li:last-child, .skills-category li:last-child, .advice-category li:last-child {
            border-bottom: none;
        }
        
        .salary-info {
            margin-top: 15px;
        }
        
        .salary-role {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .salary-role h5 {
            color: #64b5f6 !important;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .salary-levels {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .salary-level {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95em;
        }
        
        .demand-level, .remote-availability {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            text-align: center;
            margin: 5px 0;
        }
        
        .demand-level.high, .remote-availability.high {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.5);
        }
        
        .demand-level.medium, .remote-availability.medium {
            background: rgba(255, 152, 0, 0.3);
            color: #ff9800;
            border: 1px solid rgba(255, 152, 0, 0.5);
        }
        
        .demand-level.low, .remote-availability.low {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.5);
        }
        
        /* Enhanced Interview Prep Styling - Dark Theme */
        .interview-session {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .interview-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(100, 181, 246, 0.3);
        }
        
        .interview-header h4 {
            color: #64b5f6 !important;
            font-size: 1.5em;
            margin-bottom: 15px;
        }
        
        .interview-progress {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        #questionCounter {
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .progress-bar {
            width: 100%;
            max-width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .current-question-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .question-display {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-display h5 {
            color: #64b5f6 !important;
            font-size: 1.3em;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .question-focus, .question-tip {
            color: rgba(255, 255, 255, 0.8);
            margin: 8px 0;
            font-size: 1em;
            line-height: 1.5;
        }
        
        .question-tip {
            color: #4caf50;
            font-style: italic;
        }
        
        .answer-input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .answer-input-section label {
            display: block;
            margin-bottom: 12px;
            color: #64b5f6;
            font-weight: 600;
            font-size: 1.1em;
        }
        
        .answer-input-section textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 16px;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .answer-input-section textarea:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 20px rgba(100, 181, 246, 0.3);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .answer-input-section textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .answer-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .answer-actions .btn {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        .answer-actions .btn.primary {
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            border: none;
            color: white;
        }
        
        .answer-actions .btn.primary:hover {
            background: linear-gradient(45deg, #42a5f5, #2196f3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.4);
        }
        
        .answer-actions .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.9);
        }
        
        .answer-actions .btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
        
        /* Interview Complete Section */
        .interview-complete {
            background: rgba(76, 175, 80, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            border: 1px solid rgba(76, 175, 80, 0.3);
            text-align: center;
        }
        
        .interview-complete h4 {
            color: #4caf50 !important;
            font-size: 1.4em;
            margin-bottom: 20px;
        }
        
        .final-evaluation {
            text-align: left;
            margin-top: 20px;
        }
        
        .final-evaluation h5 {
            color: #64b5f6 !important;
            font-size: 1.2em;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(100, 181, 246, 0.3);
        }
        
        .answer-review {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 18px;
            margin: 15px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .answer-review h6 {
            color: #64b5f6 !important;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .answer-review p {
            color: rgba(255, 255, 255, 0.9);
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .comprehensive-feedback {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid rgba(100, 181, 246, 0.3);
            border-left: 4px solid #64b5f6;
        }
        
        .comprehensive-feedback p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin: 0;
        }
        
        .interview-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .interview-actions .btn {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            min-width: 160px;
        }
        
        /* Loading States */
        .btn.loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn.loading .btn-text {
            opacity: 0;
        }
        
        .btn.loading .btn-loading {
            opacity: 1;
        }
        
        .btn .btn-text, .btn .btn-loading {
            transition: opacity 0.3s ease;
        }
        
        .btn .btn-loading {
            opacity: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        /* Loading and Error States */
        .loading-feedback {
            text-align: center;
            padding: 30px;
            color: #64b5f6;
            font-size: 1.1em;
            font-weight: 600;
        }
        
        .error-feedback {
            text-align: center;
            padding: 30px;
            color: #f44336;
            font-size: 1.1em;
            font-weight: 600;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        /* Comprehensive Loading System */
        .loading-container {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 20px 0;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #64b5f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-message {
            color: #64b5f6;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        .loading-dots span {
            width: 8px;
            height: 8px;
            background: #64b5f6;
            border-radius: 50%;
            animation: dots 1.4s ease-in-out infinite both;
        }
        
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        .loading-dots span:nth-child(3) { animation-delay: 0s; }
        
        @keyframes dots {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Upload Loading */
        .upload-loading {
            text-align: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .upload-loading p {
            color: rgba(255, 255, 255, 0.9);
            margin: 10px 0;
        }
        
        .upload-loading .loading-spinner {
            margin-bottom: 15px;
        }
        
        /* Button Loading States */
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .btn.loading {
            position: relative;
            pointer-events: none;
        }
        
        .btn.loading .btn-text {
            opacity: 0;
        }
        
        .btn.loading .btn-loading {
            opacity: 1;
        }
        
        /* Global Loading Overlay */
        .global-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .global-loading .loading-spinner {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
        }
        
        .global-loading .loading-message {
            color: #ffffff;
            font-size: 1.3em;
            font-weight: 600;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #64b5f6, #42a5f5, #2196f3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .tab {
            padding: 15px 30px;
            margin: 0 10px;
            background: transparent;
            border: none;
            color: #ffffff;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .tab.active {
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            box-shadow: 0 4px 15px rgba(100, 181, 246, 0.3);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            color: #64b5f6;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #e3f2fd;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #64b5f6;
            box-shadow: 0 0 15px rgba(100, 181, 246, 0.3);
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn {
            background: linear-gradient(45deg, #64b5f6, #42a5f5);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 181, 246, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #ff7043, #ff5722);
        }

        .btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(255, 112, 67, 0.4);
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
        }

        .voice-btn {
            padding: 12px 20px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .voice-btn.recording {
            background: #f44336;
            color: white;
            animation: pulse 1.5s infinite;
        }

        .voice-btn:not(.recording) {
            background: #4caf50;
            color: white;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Mobile Voice Fallback Styling */
        .mobile-voice-fallback {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }

        .mobile-voice-notice {
            text-align: center;
        }

        .mobile-voice-notice h4 {
            color: #64b5f6;
            margin-bottom: 10px;
        }

        .mobile-voice-notice p {
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .mobile-voice-notice .btn {
            margin-top: 15px;
        }

        /* Enhanced Voice Button Styling for Mobile */
        @media (max-width: 768px) {
            .voice-btn {
                padding: 12px 20px;
                font-size: 0.9rem;
                margin: 5px;
            }
            
            .voice-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .voice-status {
                font-size: 0.8rem;
                margin-top: 10px;
            }
        }

        .file-upload {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #64b5f6;
            background: rgba(100, 181, 246, 0.1);
        }

        .file-upload.dragover {
            border-color: #64b5f6;
            background: rgba(100, 181, 246, 0.2);
        }

        .result-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #64b5f6;
        }

        .payment-plans {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .plan-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .plan-card.featured {
            border-color: #64b5f6;
            box-shadow: 0 0 20px rgba(100, 181, 246, 0.3);
        }

        .plan-price {
            font-size: 2.5rem;
            font-weight: bold;
            color: #64b5f6;
            margin: 15px 0;
        }
        

        
        .motivational-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .plan-features {
            list-style: none;
            margin: 20px 0;
        }

        .plan-features li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .plan-features li:last-child {
            border-bottom: none;
        }



        .download-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(100, 181, 246, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(100, 181, 246, 0.3);
        }

        .download-section h4 {
            margin-top: 0;
            color: #64b5f6;
        }

        .download-section .btn {
            margin: 5px;
        }
        
        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
        }

        .notification.error {
            border-color: #f44336;
            background: rgba(244, 67, 54, 0.1);
        }

        .notification.info {
            border-color: #2196f3;
            background: rgba(33, 150, 243, 0.1);
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-left: auto;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        

        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        /* Loading and Notification Styles */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            color: #ffffff;
            font-size: 1.1em;
        }

        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #64b5f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .tabs {
                flex-direction: column;
                gap: 10px;
            }
            
            .tab {
                margin: 0;
            }
            
            .voice-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                min-width: auto;
            }
        }

        .cover-letter-content .letter-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            line-height: 1.6;
            white-space: pre-line;
            color: #ffffff;
        }

        .generation-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .resume-section, .cover-letter-section {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .resume-section h4, .cover-letter-section h4 {
            color: #64b5f6;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #64b5f6;
            padding-bottom: 10px;
        }

        .resume-text, .letter-text {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            line-height: 1.6;
            white-space: pre-line;
            border-left: 4px solid #64b5f6;
            color: #ffffff;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            min-width: 140px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .generation-content {
                gap: 20px;
            }
            
            .resume-section, .cover-letter-section {
                padding: 20px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons .btn {
                min-width: auto;
            }
        }
        
        /* Job Search Structured Display */
        .job-search-content {
            max-width: 100%;
        }
        
        .job-listings {
            margin-bottom: 30px;
        }
        
        .job-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            backdrop-filter: blur(10px);
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }
        
        .job-header {
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }
        
        .job-title {
            font-size: 1.4em;
            color: #1a73e8;
            margin: 0 0 8px 0;
            font-weight: 600;
        }
        
        .job-company {
            font-size: 1.1em;
            color: #5f6368;
            font-weight: 500;
        }
        
        .job-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .job-details span {
            background: #fff;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            color: #5f6368;
            border: 1px solid #e1e5e9;
        }
        
        .job-requirements, .job-responsibilities, .job-benefits {
            margin-bottom: 15px;
        }
        
        .job-requirements ul, .job-responsibilities ul, .job-benefits ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .job-requirements li, .job-responsibilities li, .job-benefits li {
            margin-bottom: 5px;
            color: #5f6368;
        }
        
        .job-deadline {
            background: #fff3cd;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .market-insights {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .insight-card {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e1e5e9;
        }
        
        .insight-card h6 {
            margin: 0 0 10px 0;
            color: #5f6368;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .insight-value {
            font-size: 1.2em;
            font-weight: 600;
            color: #1a73e8;
        }
        
        .insight-value.high { color: #34a853; }
        .insight-value.medium { color: #fbbc04; }
        .insight-value.low { color: #ea4335; }
        .insight-value.growing { color: #34a853; }
        .insight-value.stable { color: #fbbc04; }
        .insight-value.declining { color: #ea4335; }
        
        .top-skills {
            margin-top: 20px;
        }
        
        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .skill-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .application-tips {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .tip-section {
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
        }
        
        .tip-section h6 {
            margin: 0 0 10px 0;
            color: #1a73e8;
            font-size: 1em;
        }
        
        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }
        
        .keyword-tag {
            background: #fce4ec;
            color: #c2185b;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .tip-section ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .tip-section li {
            margin-bottom: 5px;
            color: #5f6368;
        }
        
        /* Mobile responsive for job search */
        @media (max-width: 768px) {
            .job-details {
                flex-direction: column;
                gap: 10px;
            }
            
            .insights-grid {
                grid-template-columns: 1fr;
            }
            
            .tips-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Analysis Result Styles */
        .analysis-result {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .analysis-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        
        .analysis-section h4 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            font-size: 1.1em;
        }
        
        .strength-item, .improvement-item, .difference-item, .recommendation-item {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #2196F3;
        }
        
        .strength-item strong, .improvement-item strong, .difference-item strong, .recommendation-item strong {
            color: #2196F3;
            display: block;
            margin-bottom: 8px;
        }
        
        .strength-item p, .improvement-item p, .difference-item p, .recommendation-item p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        
        .strength-item em, .improvement-item em, .difference-item em, .recommendation-item em {
            color: #FFC107;
            font-style: normal;
            font-weight: 600;
        }
        
        .priority-high {
            color: #f44336;
            font-weight: bold;
        }
        
        .priority-medium {
            color: #ff9800;
            font-weight: bold;
        }
        
        .priority-low {
            color: #4caf50;
            font-weight: bold;
        }
        
        .action-buttons {
            margin-top: 25px;
            text-align: center;
        }
        
        .action-buttons .btn {
            margin: 0 10px;
        }
        
        /* Interview Questions Styling */
        .interview-questions {
            padding: 20px;
        }
        
        .question-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #64b5f6;
        }
        
        .question-section h4 {
            margin: 0 0 20px 0;
            color: #64b5f6;
            font-size: 1.3em;
        }
        
        .question-item {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #2196F3;
        }
        
        .question-item h5 {
            margin: 0 0 10px 0;
            color: #2196F3;
            font-size: 1.1em;
        }
        
        .question-item p {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .question-item em {
            color: #FFC107;
            font-style: normal;
            font-weight: 600;
        }
        
        /* Generation Content Styling */
        .generation-content {
            padding: 20px;
        }
        
        .resume-section, .cover-letter-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
        }
        
        .resume-section h4, .cover-letter-section h4 {
            margin: 0 0 15px 0;
            color: #4CAF50;
            font-size: 1.3em;
        }
        
        .resume-text, .letter-text {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        /* Chat Response Styling */
        .chat-response {
            padding: 20px;
        }
        
        .chat-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #64b5f6;
        }
        
        .chat-section h4 {
            margin: 0 0 15px 0;
            color: #64b5f6;
            font-size: 1.3em;
        }
        
        .chat-section h5 {
            margin: 15px 0 10px 0;
            color: #4CAF50;
            font-size: 1.1em;
        }
        
        .chat-section p {
            margin: 10px 0;
            line-height: 1.6;
        }
        
        .chat-section ul, .chat-section ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .chat-section li {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .chat-section.main-answer {
            border-left-color: #2196F3;
        }
        
        .chat-section.main-answer h4 {
            color: #2196F3;
        }
        
        .chat-section.main-points {
            border-left-color: #FF9800;
        }
        
        .chat-section.main-points h4 {
            color: #FF9800;
        }
        
        .chat-section.action-steps {
            border-left-color: #4CAF50;
        }
        
        .chat-section.action-steps h4 {
            color: #4CAF50;
        }
        
        .chat-section.examples {
            border-left-color: #9C27B0;
        }
        
        .chat-section.examples h4 {
            color: #9C27B0;
        }
        
        .chat-section.resources {
            border-left-color: #607D8B;
        }
        
        .chat-section.resources h4 {
            color: #607D8B;
        }
        
        .chat-section.tips {
            border-left-color: #FFC107;
        }
        
        .chat-section.tips h4 {
            color: #FFC107;
        }
        
        .chat-section.next-steps {
            border-left-color: #E91E63;
        }
        
        .chat-section.next-steps h4 {
            color: #E91E63;
        }
        
        /* Career Development Styling */
        .career-development-plan {
            padding: 20px;
        }
        
        .career-section {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border-left: 4px solid #64b5f6;
        }
        
        .career-section h4 {
            margin: 0 0 20px 0;
            color: #64b5f6;
            font-size: 1.4em;
            border-bottom: 2px solid rgba(100, 181, 246, 0.3);
            padding-bottom: 10px;
        }
        
        .career-section h5 {
            margin: 15px 0 10px 0;
            color: #4CAF50;
            font-size: 1.2em;
        }
        
        .career-section h6 {
            margin: 10px 0 5px 0;
            color: #FF9800;
            font-size: 1.1em;
        }
        
        .skills-grid, .learning-grid, .networking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .skill-category, .learning-category, .networking-category {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .goal-category {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .goal-item {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid #FF9800;
        }
        
        .goal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .action-steps, .success-metrics {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
        }
        
        .career-section ul, .career-section ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .career-section li {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .career-section p {
            margin: 8px 0;
            line-height: 1.6;
        }
        
        .career-section.skills-assessment {
            border-left-color: #4CAF50;
        }
        
        .career-section.skills-assessment h4 {
            color: #4CAF50;
        }
        
        .career-section.goals {
            border-left-color: #FF9800;
        }
        
        .career-section.goals h4 {
            color: #FF9800;
        }
        
        .career-section.learning-path {
            border-left-color: #9C27B0;
        }
        
        .career-section.learning-path h4 {
            color: #9C27B0;
        }
        
        .career-section.networking {
            border-left-color: #607D8B;
        }
        
        .career-section.networking h4 {
            color: #607D8B;
        }
        
        /* Interactive Interview Styling */
        .interview-session {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .interview-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .interview-progress {
            margin-top: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .current-question-section {
            margin-bottom: 30px;
        }
        
        .question-display {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        
        .question-display h5 {
            color: #2196F3;
            font-size: 1.3em;
            margin-bottom: 15px;
        }
        
        .question-focus {
            color: #FF9800;
            font-weight: 500;
            margin: 10px 0;
        }
        
        .question-tip {
            color: #4CAF50;
            font-style: italic;
            margin: 10px 0;
        }
        
        .answer-input-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .answer-input-section label {
            display: block;
            margin-bottom: 10px;
            color: #E91E63;
            font-weight: 500;
        }
        
        .answer-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .answer-feedback {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .answer-feedback h5 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .interview-complete {
            text-align: center;
            background: rgba(76, 175, 80, 0.1);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }
        
        .interview-complete h4 {
            color: #4CAF50;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
        
        .interview-actions {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .comprehensive-feedback {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: left;
        }
        
        .comprehensive-feedback h6 {
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .comprehensive-feedback p {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        /* Job Analytics Styling */
        .job-analytics {
            padding: 20px;
        }
        
        .analytics-section {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .analytics-section h4 {
            color: #4CAF50;
            font-size: 1.4em;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid rgba(76, 175, 80, 0.3);
            padding-bottom: 10px;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .analytics-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: transform 0.2s ease;
        }
        
        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .analytics-card h5 {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .analytics-card ul {
            list-style: none;
            padding: 0;
        }
        
        .analytics-card li {
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .skills-category {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .skills-category h5 {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .salary-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .salary-role {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .salary-role h5 {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .salary-levels {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .salary-level {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
        }
        
        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .opportunity-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .opportunity-card h5 {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .remote-availability {
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .remote-availability.high {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            border: 1px solid rgba(76, 175, 80, 0.4);
        }
        
        .remote-availability.medium {
            background: rgba(255, 193, 7, 0.2);
            color: #FFC107;
            border: 1px solid rgba(255, 193, 7, 0.4);
        }
        
        .remote-availability.low {
            background: rgba(244, 67, 54, 0.2);
            color: #F44336;
            border: 1px solid rgba(244, 67, 54, 0.4);
        }
        
        .advice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .advice-category {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .advice-category h5 {
            color: #FFD700;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .remote-stats p {
            margin: 8px 0;
        }
        
        .level-comparison p {
            margin: 8px 0;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div id="authSection" class="auth-section">
        <div class="auth-container">
            <h2> Welcome to AI Career Coach</h2>
            <p>Please login or register to continue</p>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h3>Login</h3>
                <form onsubmit="handleLogin(event)">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
                <p>Don't have an account? <a href="#" id="showRegisterLink">Register here</a></p>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h3>Register</h3>
                <form onsubmit="handleRegister(event)">
                    <input type="text" id="registerName" placeholder="Full Name" required>
                    <input type="email" id="registerEmail" placeholder="Email" required>
                    <input type="password" id="registerPassword" placeholder="Password" required>
                    <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
                    <button type="submit" class="btn btn-primary">Register</button>
                </form>
                <p>Already have an account? <a href="#" id="showLoginLink">Login here</a></p>
            </div>
        </div>
    </div>
    
    <!-- Main Application (Hidden until authenticated) -->
    <div id="mainApp" class="main-app" style="display: none;">
        <div class="container">
            <div class="header">
                <div class="header-content">
                    <h1>AI Career Coach</h1>
                    <p>Your Personal AI-Powered Career Development Assistant</p>
                    <div class="user-info">
                        <span id="userEmail"></span>
                        <button onclick="logout()" class="btn btn-secondary">Logout</button>
                    </div>
                </div>
            </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('chat')">AI Chat</button>
            <button class="tab" onclick="showTab('resume')"> Resume Analysis</button>
            <button class="tab" onclick="showTab('resumeGeneration')"> Resume Generation</button>
            <button class="tab" onclick="showTab('coverLetterGeneration')"> Cover Letter Generation</button>
            <button class="tab" onclick="showTab('interview')">Interview Prep</button>
            <button class="tab" onclick="showTab('career')">Career Development</button>
                                    <button class="tab" onclick="showTab('jobs')">Job Search</button>
                        <button class="tab" onclick="showTab('payment')">Plans & Pricing</button>
        </div>

        <!-- AI Chat Tab -->
        <div id="chat" class="tab-content active">
            <div class="section">
                <h3>AI Career Coach Chat</h3>
                
                <div id="motivationalMessage" class="motivational-message">
                    <p> <strong>Welcome to your AI Career Coach!</strong> </p>
                    <p>Ready to take your career to the next level? Let's make it happen together!</p>
                </div>
                
                <div class="input-group">
                    <label for="chatInput">Ask me anything about your career:</label>
                    <textarea id="chatInput" rows="4" placeholder="e.g., How can I improve my resume? What skills are in demand? How should I prepare for interviews?"></textarea>
                </div>
                
                <div class="voice-controls">
                    <button id="voiceInputBtn" class="voice-btn" onclick="startVoiceInput('chat')">
                         Start Voice Input
                    </button>
                    <button id="voiceStopBtn" class="voice-btn" onclick="stopVoiceInput('chat')" style="display: none;">
                         Stop Recording
                    </button>
                    <span id="voiceStatus">Click to start voice input</span>

                </div>



                <button class="btn" onclick="sendChatMessage()" id="chatSendBtn">
                    <span id="chatBtnText">Send Message</span>
                    <span id="chatBtnLoading" style="display: none;"> Processing...</span>
                </button>
                
                <div id="chatResult" class="result-area" style="display: none;">
                    <div class="voice-controls">
                        <button id="chatResultVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('chat')">
                             Speak Response
                        </button>
                        <button id="chatResultVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resume Analysis Tab -->
        <div id="resume" class="tab-content">
            <div class="section">
                <h3> Resume Analysis</h3>
                

                
                <div class="file-upload" onclick="document.getElementById('resumeFile').click()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <p> Click to upload or drag & drop your resume</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">Supports PDF, Word, and text files</p>
                    <input type="file" id="resumeFile" accept=".pdf,.docx,.txt" style="display: none;" onchange="handleFileSelect(event)">
                </div>
                
                <div class="input-group">
                    <label for="analysisJobDescription">Job Description for Analysis:</label>
                    <textarea id="analysisJobDescription" rows="6" placeholder="Paste the job description here to analyze your resume against this specific role..."></textarea>
                </div>
                
                <button class="btn" onclick="analyzeResumeWithJobDescription()"> Analyze Resume</button>
                
                <div id="resumeAnalysisResult" class="result-area" style="display: none;">
                    <h4> Resume Analysis Results</h4>
                    <div id="analysisContent"></div>
                    <div class="voice-controls">
                        <button id="analysisVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('analysis')">
                             Speak Analysis
                        </button>
                        <button id="analysisVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resume Generation Tab -->
        <div id="resumeGeneration" class="tab-content">
            <div class="section">
                <h3> Resume Generation</h3>
                

                
                <div class="input-group">
                    <label for="resumeJobDescription">Job Description:</label>
                    <textarea id="resumeJobDescription" rows="6" placeholder="Paste the job description here to generate a new resume for this specific role..."></textarea>
                </div>

                <div class="voice-controls">
                    <button id="resumeVoiceBtn" class="voice-btn" onclick="startVoiceInput('resume')">
                         Voice Input
                    </button>
                    <button id="resumeVoiceStopBtn" class="voice-btn" onclick="stopVoiceInput('resume')" style="display: none;">
                         Stop
                    </button>
                    <button id="resumeVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('resume')" style="display: none;">
                         Speak Response
                    </button>
                    <button id="resumeVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()" style="display: none;">
                         Stop Speaking
                    </button>
                </div>

                <button class="btn primary" onclick="generateResume()"> Generate Resume</button>
                
                <div id="resumeResult" class="result-area" style="display: none;">
                    <h4> Generated Resume</h4>
                    <div id="resumeContent"></div>
                    <div class="voice-controls">
                        <button id="resumeResultVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('resume')">
                             Speak Result
                        </button>
                        <button id="resumeResultVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cover Letter Generation Tab -->
        <div id="coverLetterGeneration" class="tab-content">
            <div class="section">
                <h3> Cover Letter Generation</h3>
                

                
                <div class="input-group">
                    <label for="coverLetterJobDescription">Job Description:</label>
                    <textarea id="coverLetterJobDescription" rows="6" placeholder="Paste the job description here to generate a new cover letter for this specific role..."></textarea>
                </div>

                <div class="voice-controls">
                    <button id="coverLetterVoiceBtn" class="voice-btn" onclick="startVoiceInput('coverLetter')">
                         Voice Input
                    </button>
                    <button id="coverLetterVoiceStopBtn" class="voice-btn" onclick="stopVoiceInput('coverLetter')" style="display: none;">
                         Stop
                    </button>
                    <button id="coverLetterVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('coverLetter')" style="display: none;">
                         Speak Response
                    </button>
                    <button id="coverLetterVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()" style="display: none;">
                         Stop Speaking
                    </button>
                </div>

                <button class="btn primary" onclick="generateCoverLetter()"> Generate Cover Letter</button>
                
                <div id="coverLetterResult" class="result-area" style="display: none;">
                    <h4> Generated Cover Letter</h4>
                    <div id="coverLetterContent"></div>
                    <div class="voice-controls">
                        <button id="coverLetterResultVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('coverLetter')">
                             Speak Result
                        </button>
                        <button id="coverLetterResultVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interview Prep Tab -->
        <div id="interview" class="tab-content">
            <div class="section">
                <h3> Interactive Interview Practice</h3>
                <p>Practice with me one-on-one! I'll ask you questions one by one, give you feedback, and provide a final evaluation - just like a real interview.</p>
                
                <div class="input-group">
                    <label for="interviewJobDescription">Job Description for Interview Prep:</label>
                    <textarea id="interviewJobDescription" rows="6" placeholder="Paste the job description here to get personalized interview questions..."></textarea>
                </div>

                <div class="voice-controls">
                    <button id="interviewVoiceBtn" class="voice-btn" onclick="startVoiceInput('interview')">
                         Voice Input
                    </button>
                    <button id="interviewVoiceStopBtn" class="voice-btn" onclick="stopVoiceInput('interview')" style="display: none;">
                         Stop
                    </button>
                    <button id="interviewVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('interview')" style="display: none;">
                         Speak Response
                    </button>
                    <button id="interviewVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()" style="display: none;">
                         Stop Speaking
                    </button>
                </div>

                <button class="btn primary" onclick="generateInterviewQuestions()"> Start Question-by-Question Interview</button>
                
                <!-- Question-by-Question Interview Interface -->
                <div id="interviewSession" class="interview-session" style="display: none;">
                    <div class="interview-header">
                        <h4> Interview in Progress</h4>
                        <div class="interview-progress">
                            <span id="questionCounter">Question 1 of 5</span>
                            <div class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="current-question-section">
                        <div id="currentQuestion" class="question-display">
                            <h5 id="questionText">Loading question...</h5>
                            <p id="questionFocus" class="question-focus"></p>
                            <p id="questionTip" class="question-tip"></p>
                        </div>
                        
                        <div class="answer-input-section">
                            <label for="userAnswer">Your Answer:</label>
                            <textarea id="userAnswer" rows="8" placeholder="Type your detailed answer here... (Take your time to provide a comprehensive response)"></textarea>
                            
                            <div class="answer-actions">
                                <button id="submitAnswerBtn" class="btn primary" onclick="submitAnswer()">
                                    <span id="submitBtnText"> Submit Answer</span>
                                    <span id="submitBtnLoading" style="display: none;"> Processing...</span>
                                </button>
                                <button id="skipQuestionBtn" class="btn secondary" onclick="skipQuestion()"> Skip Question</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="interviewComplete" class="interview-complete" style="display: none;">
                        <h4> Interview Complete!</h4>
                        <div id="finalFeedback"></div>
                        <div class="interview-actions">
                            <button class="btn primary" onclick="restartInterview()"> Start New Interview</button>
                            <button class="btn secondary" onclick="downloadInterviewReport()"> Download Report</button>
                        </div>
                    </div>
                </div>
                
                <!-- Static question list (hidden by default) -->
                <div id="interviewResult" class="result-area" style="display: none;">
                    <h4> All Interview Questions</h4>
                    <div id="interviewContent"></div>
                    <div class="voice-controls">
                        <button id="interviewResultVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('interview')">
                             Speak Questions
                        </button>
                        <button id="interviewResultVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Career Development Tab -->
        <div id="career" class="tab-content">
            <div class="section">
                <h3>Career Development Planning</h3>
                
                <div class="input-group">
                    <label for="userProfile">Your Profile:</label>
                    <textarea id="userProfile" rows="4" placeholder="Describe your current role, experience, skills, and background..."></textarea>
                </div>

                <div class="input-group">
                    <label for="careerGoals">Career Goals:</label>
                    <textarea id="careerGoals" rows="4" placeholder="What are your short-term and long-term career goals?"></textarea>
                </div>

                <div class="voice-controls">
                    <button id="careerVoiceBtn" class="voice-btn" onclick="startVoiceInput('career')">
                         Voice Input
                    </button>
                    <button id="careerVoiceStopBtn" class="voice-btn" onclick="stopVoiceInput('career')" style="display: none;">
                         Stop
                    </button>
                    <button id="careerVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('career')" style="display: none;">
                         Speak Response
                        </button>
                    <button id="careerVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()" style="display: none;">
                         Stop Speaking
                    </button>
                </div>

                <button class="btn" onclick="generateCareerPlan()">Generate Career Plan</button>
                
                <div id="careerResult" class="result-area" style="display: none;">
                    <div class="voice-controls">
                        <button id="careerResultVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('career')">
                             Speak Career Plan
                        </button>
                        <button id="careerResultVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Job Market Tab -->
        <div id="jobs" class="tab-content">
            <div class="section">
                <h3> Job Search & Market Insights</h3>
                
                <div class="input-group">
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">Search for jobs and get market insights to boost your career.</p>
                </div>
                
                <h4>Job Search</h4>
                <div class="input-group">
                    <label for="jobQuery">Job Title/Keywords:</label>
                    <input type="text" id="jobQuery" placeholder="e.g., Python Developer, Data Analyst">
                </div>
                
                <div class="input-group">
                    <label for="jobLocation">Location:</label>
                    <input type="text" id="jobLocation" placeholder="e.g., Remote, New York, CA">
                </div>
                
                <button class="btn" onclick="searchJobs()">Search Jobs</button>
                
                <div id="jobSearchResult" class="result-area" style="display: none;">
                    <div class="voice-controls">
                        <button id="jobSearchVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('jobSearch')">
                             Speak Job Results
                        </button>
                        <button id="jobSearchVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    </div>
                </div>
                
                <!-- Job Market Analytics Section -->
                <div class="analytics-section" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid rgba(255,255,255,0.2);">
                    <h4> Job Market Analytics</h4>
                    <p style="color: rgba(255,255,255,0.8); margin-bottom: 20px;">Get comprehensive insights into current job market trends, salary data, and in-demand skills.</p>
                    
                    <div class="input-group">
                        <label for="analyticsQuery">Job Title/Keywords for Analytics:</label>
                        <input type="text" id="analyticsQuery" placeholder="e.g., Software Engineer, Data Analyst, Marketing Manager">
                    </div>
                    
                    <button class="btn" onclick="getJobAnalytics()"> Get Market Analytics</button>
                    
                    <div id="analyticsResult" class="result-area" style="display: none;">
                        <div class="voice-controls">
                            <button id="analyticsVoiceOutputBtn" class="voice-btn secondary" onclick="speakLastResponse('analytics')">
                                 Speak Analytics
                            </button>
                            <button id="analyticsVoiceStopOutputBtn" class="voice-btn secondary" onclick="stopSpeech()">
                                 Stop Speaking
                            </button>
                        </div>
                        <div id="analyticsContent"></div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Payment Plans Tab -->
        <div id="payment" class="tab-content">
            <div class="section">
                <h3>Choose Your Plan</h3>
                
                <div class="payment-plans">
                    <div class="plan-card">
                        <h4>Free Trial</h4>
                        <div class="plan-price">$0</div>
                        <p>7 days free access</p>
                        <ul class="plan-features">
                            <li>Basic AI Chat</li>
                            <li>Resume Analysis (2x)</li>
                            <li>Cover Letter Generation (1x)</li>
                            <li>Interview Prep (1x)</li>
                        </ul>
                        <button class="btn" onclick="selectPlan('free')">Start Free Trial</button>
                    </div>

                    <div class="plan-card featured">
                        <h4>Basic Plan</h4>
                        <div class="plan-price">$9.99</div>
                        <p>per month</p>
                        <ul class="plan-features">
                            <li>Unlimited AI Chat</li>
                            <li>Resume Optimization (10x)</li>
                            <li>Cover Letters (5x)</li>
                            <li>Interview Prep (5x)</li>
                            <li>Career Planning (5x)</li>
                        </ul>
                        <button class="btn" onclick="selectPlan('basic')">Choose Basic</button>
                    </div>

                    <div class="plan-card">
                        <h4>Premium Plan</h4>
                        <div class="plan-price">$19.99</div>
                        <p>per month</p>
                        <ul class="plan-features">
                            <li>Everything in Basic</li>
                            <li>Advanced Analytics</li>
                            <li>Priority Support</li>
                            <li>Custom Voice Profiles</li>
                            <li>Unlimited Usage</li>
                        </ul>
                        <button class="btn" onclick="selectPlan('premium')">Choose Premium</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/docx@8.5.0/build/index.js" onerror="console.warn('docx library failed to load, will use fallback')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Library initialization check
        let librariesLoaded = {
            docx: false,
            jspdf: false
        };
        
        // Check if libraries are loaded
        function checkLibraries() {
            try {
                // Check docx library with multiple fallback methods
                if (typeof docx !== 'undefined' && docx.Document && docx.Packer) {
                    librariesLoaded.docx = true;
                    console.log(' docx library loaded successfully');
                } else if (typeof window.docx !== 'undefined' && window.docx.Document && window.docx.Packer) {
                    librariesLoaded.docx = true;
                    console.log(' docx library loaded successfully (window object)');
                } else {
                    console.warn(' docx library not loaded, will use HTML fallback');
                    librariesLoaded.docx = false;
                }
                
                if (typeof jspdf !== 'undefined') {
                    librariesLoaded.jspdf = true;
                    console.log(' jspdf library loaded successfully');
                } else if (typeof window.jspdf !== 'undefined') {
                    librariesLoaded.jspdf = true;
                    console.log(' jspdf library loaded successfully (window object)');
                } else {
                    console.warn(' jspdf library not loaded');
                    librariesLoaded.jspdf = false;
                }
            } catch (error) {
                console.error('Error checking libraries:', error);
            }
        }
        
        // Wait for libraries to load
        window.addEventListener('load', function() {
            setTimeout(checkLibraries, 1000); // Check after 1 second
        });
        
        // Tab Management
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Enhanced Voice Recognition Setup - Cross-Platform Compatible
        let recognition = null;
        let currentVoiceMode = 'chat';
        let isRecording = false;
        let isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // Initialize voice recognition with cross-platform support
        function initializeVoiceRecognition() {
            // Try different speech recognition APIs
            if ('webkitSpeechRecognition' in window) {
                // Chrome/Edge
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                // Firefox/Safari (future)
                recognition = new SpeechRecognition();
            } else if ('mozSpeechRecognition' in window) {
                // Firefox
                recognition = new mozSpeechRecognition();
            } else if ('msSpeechRecognition' in window) {
                // IE/Edge
                recognition = new msSpeechRecognition();
            }
            
            if (recognition) {
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isRecording = true;
                    updateVoiceUI(true);
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    updateVoiceInput(transcript);
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    handleVoiceError(event.error);
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    updateVoiceUI(false);
                };
            } else {
                console.log('Speech recognition not supported on this device');
                showMobileVoiceFallback();
            }
        }

        // Start voice input with enhanced mobile support
        function startVoiceInput(mode) {
            currentVoiceMode = mode;
            
            // Check if we're on mobile and need to request permissions
            if (isMobileDevice) {
                requestMicrophonePermission();
            }
            
            if (!recognition) {
                initializeVoiceRecognition();
            }
            
            if (isRecording) {
                stopVoiceInput();
                return;
            }
            
            try {
                recognition.start();
            } catch (error) {
                console.error('Error starting voice recognition:', error);
                if (isMobileDevice) {
                    showMobileVoiceFallback();
                } else {
                    showNotification(' Voice recognition failed. Please try again.', 'error');
                }
            }
        }

        // Stop voice input
        function stopVoiceInput() {
            if (recognition && isRecording) {
                recognition.stop();
                recognition.abort();
            }
        }



        // File handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadFile(file);
            }
        }

        function handleFileDrop(event) {
            event.preventDefault();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                uploadFile(files[0]);
            }
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }

        // This function is replaced by the enhanced version below

        // API Functions
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Show loading state
            const btn = document.getElementById('chatSendBtn');
            const btnText = document.getElementById('chatBtnText');
            const btnLoading = document.getElementById('chatBtnLoading');
            
            btn.disabled = true;
            btnText.style.display = 'none';
            btnLoading.style.display = 'inline';
            
            showLoading('chatResult');
            addToChatMemory(message);
            
            fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message, userId: 'user123' })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.result) {
                    displayResult('chatResult', data.result, 'chat');
                    speakText(data.result.answer || data.result);
                } else {
                    throw new Error(data.error || 'Failed to get response');
                }
            })
            .catch(error => {
                console.error('Chat error:', error);
                displayResult('chatResult', 'Error: Unable to get response. Please try again.');
            })
            .finally(() => {
                // Reset button state
                btn.disabled = false;
                btnText.style.display = 'inline';
                btnLoading.style.display = 'none';
                
                hideLoading('chatResult');
                input.value = '';
            });
        }

        function generateCareerPlan() {
            const profile = document.getElementById('userProfile').value.trim();
            const goals = document.getElementById('careerGoals').value.trim();
            
            if (!profile || !goals) {
                alert('Please enter both your profile and career goals.');
                return;
            }
            
            showLoading('careerResult', ' Generating personalized career development plan...');
            
            fetch('/api/career-development', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    userProfile: profile, 
                    goals: goals, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading('careerResult');
                if (data.success) {
                    displayResult('careerResult', data.result);
                } else {
                    throw new Error(data.error || 'Failed to generate career plan');
                }
            })
            .catch(error => {
                console.error('Career planning error:', error);
                hideLoading('careerResult');
                displayResult('careerResult', 'Error: Unable to generate career plan. Please try again.');
            });
        }

        // Job Market Functions
        function getJobAnalytics() {
            const query = document.getElementById('analyticsQuery').value.trim();
            
            if (!query) {
                alert('Please enter a job title or keywords for analytics.');
                return;
            }
            
            showLoading('analyticsResult', ' Fetching market analytics...');
            
            fetch('/api/job-analytics', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                hideLoading('analyticsResult');
                
                if (data.success) {
                    displayResult('analyticsResult', data.result, 'analytics');
                    document.getElementById('analyticsResult').style.display = 'block';
                } else {
                    displayResult('analyticsResult', 'Error: Unable to fetch job analytics. Please try again.');
                }
            })
            .catch(error => {
                console.error('Analytics error:', error);
                hideLoading('analyticsResult');
                displayResult('analyticsResult', 'Error: Unable to fetch job analytics. Please try again.');
            });
        }

                function searchJobs() {
            const query = document.getElementById('jobQuery').value.trim();
            const location = document.getElementById('jobLocation').value.trim();
            
            if (!query) {
                alert('Please enter a job title or keywords to search.');
                return;
            }
            
            showLoading('jobSearchResult', ' Searching for jobs...');
            
            fetch('/api/search-jobs', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query, location })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading('jobSearchResult');
                
                if (data.success) {
                    const result = data.result;
                    
                    if (result && typeof result === 'object') {
                        // Display structured job data
                        document.getElementById('jobSearchResult').innerHTML = `
                            <div class="job-search-content">
                                <h4> Job Search Results</h4>
                                
                                <!-- Job Listings -->
                                <div class="job-listings">
                                    <h5> Available Positions</h5>
                                    ${result.jobListings ? result.jobListings.map(job => `
                                        <div class="job-card">
                                            <div class="job-header">
                                                <h6 class="job-title">${job.title}</h6>
                                                <span class="job-company">${job.company}</span>
                                            </div>
                                            <div class="job-details">
                                                <span class="job-location"> ${job.location}</span>
                                                <span class="job-salary"> ${job.salary}</span>
                                                <span class="job-type"> ${job.type}</span>
                                                <span class="job-posted"> ${job.posted}</span>
                                            </div>
                                            <div class="job-requirements">
                                                <strong>Requirements:</strong>
                                                <ul>${job.requirements.map(req => `<li>${req}</li>`).join('')}</ul>
                                            </div>
                                            <div class="job-responsibilities">
                                                <strong>Responsibilities:</strong>
                                                <ul>${job.responsibilities.map(resp => `<li>${resp}</li>`).join('')}</ul>
                                            </div>
                                            <div class="job-benefits">
                                                <strong>Benefits:</strong>
                                                <ul>${job.benefits.map(benefit => `<li>${benefit}</li>`).join('')}</ul>
                                            </div>
                                            <div class="job-deadline">
                                                <strong>Application Deadline:</strong> ${job.applicationDeadline}
                                            </div>
                                        </div>
                                    `).join('') : '<p>No job listings available</p>'}
                                </div>
                                
                                <!-- Market Insights -->
                                ${result.marketInsights ? `
                                    <div class="market-insights">
                                        <h5> Market Insights</h5>
                                        <div class="insights-grid">
                                            <div class="insight-card">
                                                <h6>Demand</h6>
                                                <span class="insight-value ${result.marketInsights.demand.toLowerCase()}">${result.marketInsights.demand}</span>
                                            </div>
                                            <div class="insight-card">
                                                <h6>Salary Range</h6>
                                                <span class="insight-value">${result.marketInsights.salaryRange}</span>
                                            </div>
                                            <div class="insight-card">
                                                <h6>Growth Trend</h6>
                                                <span class="insight-value ${result.marketInsights.growthTrend.toLowerCase()}">${result.marketInsights.growthTrend}</span>
                                            </div>
                                        </div>
                                        <div class="top-skills">
                                            <strong>Top Skills:</strong>
                                            <div class="skills-tags">
                                                ${result.marketInsights.topSkills.map(skill => `<span class="skill-tag">${skill}</span>`).join('')}
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <!-- Application Tips -->
                                ${result.applicationTips ? `
                                    <div class="application-tips">
                                        <h5> Application Tips</h5>
                                        <div class="tips-grid">
                                            <div class="tip-section">
                                                <h6>Resume Keywords</h6>
                                                <div class="keyword-tags">
                                                    ${result.applicationTips.resumeKeywords.map(keyword => `<span class="keyword-tag">${keyword}</span>`).join('')}
                                                </div>
                                            </div>
                                            <div class="tip-section">
                                                <h6>Stand Out Strategies</h6>
                                                <ul>${result.applicationTips.standoutStrategies.map(strategy => `<li>${strategy}</li>`).join('')}</ul>
                                            </div>
                                            <div class="tip-section">
                                                <h6>Interview Prep</h6>
                                                <ul>${result.applicationTips.interviewPrep.map(tip => `<li>${tip}</li>`).join('')}</ul>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    } else {
                        // Fallback for non-structured data
                        displayResult('jobSearchResult', result);
                    }
                    showNotification(' Job search completed successfully!', 'success');
                } else {
                    document.getElementById('jobSearchResult').innerHTML = `
                        <div class="error-message">
                             ${data.error || 'Failed to search jobs'}
                        </div>
                    `;
                    showNotification(' Job search failed', 'error');
                }
                
                document.getElementById('jobSearchResult').style.display = 'block';
            })
            .catch(error => {
                hideLoading('jobSearchResult');
                console.error('Job search error:', error);
                document.getElementById('jobSearchResult').innerHTML = `
                    <div class="error-message">
                         Error: ${error.message || 'Unable to search jobs. Please try again.'}
                    </div>
                `;
                document.getElementById('jobSearchResult').style.display = 'block';
                showNotification(' Job search failed', 'error');
            });
        }

        // Enhanced Download Functions
        function addDownloadOptions(resultDiv, content, title, type) {
            const downloadSection = document.createElement('div');
            downloadSection.className = 'download-section';
            downloadSection.innerHTML = `
                <h4> Download Options</h4>
                <button onclick="downloadAsWord('${content.replace(/'/g, "\\'")}', '${title}')" class="btn secondary">
                    Download as Word (.docx)
                </button>
                <button onclick="downloadAsPDF('${content.replace(/'/g, "\\'")}', '${title}')" class="btn secondary">
                    Download as PDF
                </button>
            `;
            
            resultDiv.appendChild(downloadSection);
        }

        async function downloadAsWord(content, title) {
            try {
                const response = await fetch('/api/download-resume-word', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content, title })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${title}.docx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                } else {
                    alert('Failed to download document');
                }
            } catch (error) {
                alert('Error downloading document: ' + error.message);
            }
        }

        async function downloadAsPDF(content, title) {
            // For PDF, we'll use browser's print functionality
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head>
                        <title>${title}</title>
                        <style>
                            body { font-family: Arial, sans-serif; line-height: 1.6; margin: 20px; }
                            h1 { color: #333; }
                        </style>
                    </head>
                    <body>
                        <h1>${title}</h1>
                        <div>${content.replace(/\n/g, '<br>')}</div>
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Enhanced Resume Optimization with Download Options
        function optimizeResume() {
            const jobDesc = document.getElementById('jobDescription').value.trim();
            const resumeContent = window.uploadedResumeContent || 'Resume content not uploaded';
            
            if (!jobDesc) {
                alert('Please enter a job description first.');
                return;
            }
            
            fetch('/api/update-resume', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    resumeText: resumeContent, 
                    jobDescription: jobDesc, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('resumeResult');
                const contentDiv = document.getElementById('optimizedContent');
                contentDiv.innerHTML = data.result;
                resultDiv.style.display = 'block';
                
                // Show voice controls
                const voiceControls = resultDiv.querySelector('.voice-controls');
                if (voiceControls) {
                    voiceControls.style.display = 'flex';
                }
                
                // Add download options
                addDownloadOptions(resultDiv, data.result, 'Optimized Resume', 'resume');
                
                // Show cover letter section
                document.getElementById('coverLetterSection').style.display = 'block';
                
                // Auto-generate cover letter after 2 seconds
                setTimeout(() => {
                    if (confirm('Would you like me to generate a cover letter for this job as well?')) {
                        generateCoverLetter();
                    }
                }, 2000);
            })
            .catch(error => {
                console.error('Resume optimization error:', error);
                displayResult('resumeResult', 'Error: Unable to optimize resume. Please try again.');
            });
        }

        function generateCoverLetter() {
            const jobDesc = document.getElementById('jobDescription').value.trim();
            
            if (!jobDesc) {
                alert('Please enter a job description first.');
                return;
            }
            
            fetch('/api/update-resume', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    resumeText: 'Generate a professional cover letter', 
                    jobDescription: jobDesc, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                const resultDiv = document.getElementById('resumeResult');
                resultDiv.textContent = 'Cover Letter Generated:\n\n' + data.result;
                resultDiv.style.display = 'block';
                
                // Show voice controls
                const voiceControls = resultDiv.querySelector('.voice-controls');
                if (voiceControls) {
                    voiceControls.style.display = 'flex';
                }
                
                // Add download options
                addDownloadOptions(resultDiv, data.result, 'Cover Letter', 'coverLetter');
            })
            .catch(error => {
                console.error('Cover letter error:', error);
                displayResult('resumeResult', 'Error: Unable to generate cover letter. Please try again.');
            });
        }

        function generateInterviewQuestions() {
            console.log(' generateInterviewQuestions called');
            
            // Check if element exists
            const element = document.getElementById('interviewJobDescription');
            if (!element) {
                console.error(' interviewJobDescription element not found');
                showNotification(' Job description input not found. Please refresh the page.', 'error');
                return;
            }
            
            const jobDescription = element.value.trim();
            console.log(' Job description:', jobDescription);
            
            if (!jobDescription) {
                showNotification(' Please enter a job description first', 'error');
                return;
            }
            
            // Check if other elements exist
            const sessionElement = document.getElementById('interviewSession');
            const resultElement = document.getElementById('interviewResult');
            
            if (!sessionElement || !resultElement) {
                console.error(' Required elements not found:', {
                    session: !!sessionElement,
                    result: !!resultElement
                });
                showNotification(' Interview interface not loaded. Please refresh the page.', 'error');
                return;
            }
            
            // Show loading state
            showLoading('interviewSession', ' Generating personalized interview questions...');
            
            // Show the interactive interview session instead of static list
            sessionElement.style.display = 'block';
            resultElement.style.display = 'none';
            
            console.log(' Starting interactive interview with questions...');
            
            // Start the interactive interview directly
            startInteractiveInterview();
        }

        function displayResult(elementId, content) {
            const element = document.getElementById(elementId);
            if (element && content) {
                let displayContent = '';
                
                // Handle different content types
                if (typeof content === 'string') {
                    // Check if content contains HTML tags
                    if (content.includes('<') && content.includes('>')) {
                        displayContent = content;
                    } else {
                        displayContent = content.replace(/\n/g, '<br>');
                    }
                } else if (typeof content === 'object' && content !== null) {
                    // Handle JSON objects - format them nicely
                    if (content.behavioralQuestions || content.technicalQuestions || content.situationalQuestions) {
                        // Interview questions format
                        displayContent = formatInterviewQuestions(content);
                    } else if (content.resume || content.coverLetter) {
                        // Resume generation format
                        displayContent = formatResumeGeneration(content);
                    } else if (content.analysis) {
                        // Resume analysis format
                        displayContent = formatResumeAnalysis(content);
                                    } else if (elementId === 'chatResult') {
                    // Chat response format
                    displayContent = formatChatResponse(content);
                } else if (elementId === 'careerResult') {
                    // Career development format
                    displayContent = formatCareerDevelopment(content);
                } else if (elementId === 'analyticsResult') {
                    // Job analytics format
                    displayContent = formatJobAnalytics(content);
                } else {
                    // Generic object - convert to readable format
                    displayContent = `<pre>${JSON.stringify(content, null, 2)}</pre>`;
                }
                } else {
                    displayContent = String(content);
                }
                
                element.innerHTML = displayContent;
                element.style.display = 'block';
                
                // Show voice controls if they exist
                const voiceControls = element.querySelector('.voice-controls');
                if (voiceControls) {
                    voiceControls.style.display = 'flex';
                }
                
                // Add voice controls if they don't exist
                if (!voiceControls) {
                    const voiceControlsDiv = document.createElement('div');
                    voiceControlsDiv.className = 'voice-controls';
                    voiceControlsDiv.innerHTML = `
                        <button class="voice-btn secondary" onclick="speakLastResponse('${elementId.replace('Result', '')}')">
                             Speak Response
                        </button>
                        <button class="voice-btn secondary" onclick="stopSpeech()">
                             Stop Speaking
                        </button>
                    `;
                    element.appendChild(voiceControlsDiv);
                }
            }
        }
        
        // Format interview questions for display
        function formatInterviewQuestions(data) {
            let html = '<div class="interview-questions">';
            
            if (data.behavioralQuestions && data.behavioralQuestions.length > 0) {
                html += '<div class="question-section"><h4> Behavioral Questions</h4>';
                data.behavioralQuestions.forEach((q, index) => {
                    html += `
                        <div class="question-item">
                            <h5>Question ${index + 1}:</h5>
                            <p><strong>${q.question}</strong></p>
                            <p><em>Focus:</em> ${q.focus}</p>
                            <p><em>Tip:</em> ${q.tip}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.technicalQuestions && data.technicalQuestions.length > 0) {
                html += '<div class="question-section"><h4> Technical Questions</h4>';
                data.technicalQuestions.forEach((q, index) => {
                    html += `
                        <div class="question-item">
                            <h5>Question ${index + 1}:</h5>
                            <p><strong>${q.question}</strong></p>
                            <p><em>Focus:</em> ${q.focus}</p>
                            <p><em>Tip:</em> ${q.tip}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.situationalQuestions && data.situationalQuestions.length > 0) {
                html += '<div class="question-section"><h4> Situational Questions</h4>';
                data.situationalQuestions.forEach((q, index) => {
                    html += `
                        <div class="question-item">
                            <h5>Question ${index + 1}:</h5>
                            <p><strong>${q.question}</strong></p>
                            <p><em>Focus:</em> ${q.focus}</p>
                            <p><em>Tip:</em> ${q.tip}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.generalTips && data.generalTips.length > 0) {
                html += '<div class="question-section"><h4> General Tips</h4><ul>';
                data.generalTips.forEach(tip => {
                    html += `<li>${tip}</li>`;
                });
                html += '</ul></div>';
            }
            
            if (data.questionsToAsk && data.questionsToAsk.length > 0) {
                html += '<div class="question-section"><h4> Questions to Ask</h4>';
                data.questionsToAsk.forEach((q, index) => {
                    html += `
                        <div class="question-item">
                            <h5>Question ${index + 1}:</h5>
                            <p><strong>${q.question}</strong></p>
                            <p><em>Purpose:</em> ${q.purpose || q.focus || 'Shows interest and preparation'}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }
        
        // Format resume generation results
        function formatResumeGeneration(data) {
            let html = '<div class="generation-content">';
            
            if (data.resume) {
                html += `
                    <div class="resume-section">
                        <h4> Generated Resume</h4>
                        <div class="resume-text">${(data.resume || '').replace(/\n/g, '<br>')}</div>
                        <div class="action-buttons">
                            <button onclick="downloadGeneratedResume()" class="btn primary"> Download Resume</button>
                            <button onclick="copyGeneratedResumeToClipboard()" class="btn secondary"> Copy Resume</button>
                        </div>
                    </div>
                `;
            }
            
            if (data.coverLetter) {
                html += `
                    <div class="cover-letter-section">
                        <h4> Generated Cover Letter</h4>
                        <div class="letter-text">${(data.coverLetter || '').replace(/\n/g, '<br>')}</div>
                        <div class="action-buttons">
                            <button onclick="downloadGeneratedCoverLetter()" class="btn secondary"> Download Cover Letter</button>
                            <button onclick="copyGeneratedCoverLetter()" class="btn secondary"> Copy Cover Letter</button>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // Format resume analysis results
        function formatResumeAnalysis(data) {
            if (typeof data === 'string') {
                return data.replace(/\n/g, '<br>');
            }
            
            let html = '<div class="analysis-result">';
            
            if (data.alignmentScore) {
                html += `
                    <div class="analysis-section">
                        <h4> Alignment Score: ${data.alignmentScore.score}/10</h4>
                        <p>${data.alignmentScore.explanation}</p>
                    </div>
                `;
            }
            
            if (data.keyStrengths && data.keyStrengths.length > 0) {
                html += '<div class="analysis-section"><h4> Key Strengths</h4>';
                data.keyStrengths.forEach(strength => {
                    html += `
                        <div class="strength-item">
                            <strong>${strength.strength}</strong>
                            <p><em>Evidence:</em> ${strength.evidence}</p>
                            <p><em>Relevance:</em> ${strength.relevance}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.areasForImprovement && data.areasForImprovement.length > 0) {
                html += '<div class="analysis-section"><h4> Areas for Improvement</h4>';
                data.areasForImprovement.forEach(area => {
                    html += `
                        <div class="improvement-item">
                            <strong>${area.area}</strong>
                            <p><em>Current Level:</em> ${area.currentLevel}</p>
                            <p><em>Target Level:</em> ${area.targetLevel}</p>
                            <p><em>Action Plan:</em> ${area.actionPlan}</p>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (data.overallAssessment) {
                html += `
                    <div class="analysis-section">
                        <h4> Overall Assessment</h4>
                        <p>${data.overallAssessment}</p>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // Format chat responses
        function formatChatResponse(data) {
            if (typeof data === 'string') {
                return data.replace(/\n/g, '<br>');
            }
            
            // If it's an object with specific fields, format accordingly
            if (data && typeof data === 'object') {
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    // OpenAI API response format
                    return data.choices[0].message.content.replace(/\n/g, '<br>');
                } else if (data.answer) {
                    // Format structured answer with advice, resources, tips, etc.
                    return formatStructuredChatResponse(data);
                } else if (data.content) {
                    // Generic content field
                    return data.content.replace(/\n/g, '<br>');
                } else if (data.message) {
                    // Generic message field
                    return data.message.replace(/\n/g, '<br>');
                } else if (data.result && data.result.answer) {
                    // Nested result structure
                    return formatStructuredChatResponse(data.result);
                } else {
                    // Fallback: convert object to readable format
                    return `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            }
            
            // Fallback for any other type
            return String(data).replace(/\n/g, '<br>');
        }
        
        // Format structured chat responses with multiple sections
        function formatStructuredChatResponse(data) {
            let html = '<div class="chat-response">';
            
            // Main answer
            if (data.answer) {
                html += `
                    <div class="chat-section main-answer">
                        <h4> Answer</h4>
                        <p>${data.answer.replace(/\n/g, '<br>')}</p>
                    </div>
                `;
            }
            
            // Main points
            if (data.advice && data.advice.mainPoints && data.advice.mainPoints.length > 0) {
                html += `
                    <div class="chat-section main-points">
                        <h4> Key Points</h4>
                        <ul>
                            ${data.advice.mainPoints.map(point => `<li>${point}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Action steps
            if (data.advice && data.advice.actionSteps && data.advice.actionSteps.length > 0) {
                html += `
                    <div class="chat-section action-steps">
                        <h4> Action Steps</h4>
                        <ol>
                            ${data.advice.actionSteps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>
                `;
            }
            
            // Examples
            if (data.advice && data.advice.examples && data.advice.examples.length > 0) {
                html += `
                    <div class="chat-section examples">
                        <h4> Examples</h4>
                        <ul>
                            ${data.advice.examples.map(example => `<li>${example}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Resources
            if (data.resources) {
                html += '<div class="chat-section resources">';
                html += '<h4> Resources</h4>';
                
                if (data.resources.tools && data.resources.tools.length > 0) {
                    html += '<h5> Tools</h5><ul>';
                    data.resources.tools.forEach(tool => html += `<li>${tool}</li>`);
                    html += '</ul>';
                }
                
                if (data.resources.websites && data.resources.websites.length > 0) {
                    html += '<h5> Websites</h5><ul>';
                    data.resources.websites.forEach(site => html += `<li>${site}</li>`);
                    html += '</ul>';
                }
                
                if (data.resources.books && data.resources.books.length > 0) {
                    html += '<h5> Books</h5><ul>';
                    data.resources.books.forEach(book => html += `<li>${book}</li>`);
                    html += '</ul>';
                }
                
                html += '</div>';
            }
            
            // Tips
            if (data.tips && data.tips.length > 0) {
                html += `
                    <div class="chat-section tips">
                        <h4> Pro Tips</h4>
                        <ul>
                            ${data.tips.map(tip => `<li>${tip}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            // Next steps
            if (data.nextSteps && data.nextSteps.length > 0) {
                html += `
                    <div class="chat-section next-steps">
                        <h4> Next Steps</h4>
                        <ol>
                            ${data.nextSteps.map(step => `<li>${step}</li>`).join('')}
                        </ol>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // Format career development plan for display
        function formatCareerDevelopment(data) {
            let html = '<div class="career-development-plan">';
            
            // Skills Assessment
            if (data.skillsAssessment) {
                html += `
                    <div class="career-section skills-assessment">
                        <h4> Skills Assessment</h4>
                        <div class="skills-grid">
                            <div class="skill-category">
                                <h5> Current Skills</h5>
                                <ul>
                                    ${data.skillsAssessment.currentSkills.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="skill-category">
                                <h5> Missing Skills</h5>
                                <ul>
                                    ${data.skillsAssessment.missingSkills.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="skill-category">
                                <h5> Skill Gaps</h5>
                                <ul>
                                    ${data.skillsAssessment.skillGaps.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Goals
            if (data.goals) {
                html += '<div class="career-section goals">';
                html += '<h4> Career Goals</h4>';
                
                if (data.goals.shortTerm && data.goals.shortTerm.length > 0) {
                    html += '<div class="goal-category"><h5> Short Term (3-6 months)</h5>';
                    data.goals.shortTerm.forEach(goal => {
                        html += `
                            <div class="goal-item">
                                <h6>${goal.title}</h6>
                                <p><strong>Description:</strong> ${goal.description}</p>
                                <p><strong>Timeline:</strong> ${goal.timeline}</p>
                                <div class="goal-details">
                                    <div class="action-steps">
                                        <h6> Action Steps:</h6>
                                        <ol>
                                            ${goal.actionSteps.map(step => `<li>${step}</li>`).join('')}
                                        </ol>
                                    </div>
                                    <div class="success-metrics">
                                        <h6> Success Metrics:</h6>
                                        <ul>
                                            ${goal.successMetrics.map(metric => `<li>${metric}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                if (data.goals.mediumTerm && data.goals.mediumTerm.length > 0) {
                    html += '<div class="goal-category"><h5> Medium Term (6-12 months)</h5>';
                    data.goals.mediumTerm.forEach(goal => {
                        html += `
                            <div class="goal-item">
                                <h6>${goal.title}</h6>
                                <p><strong>Description:</strong> ${goal.description}</p>
                                <p><strong>Timeline:</strong> ${goal.timeline}</p>
                                <div class="goal-details">
                                    <div class="action-steps">
                                        <h6> Action Steps:</h6>
                                        <ol>
                                            ${goal.actionSteps.map(step => `<li>${step}</li>`).join('')}
                                        </ol>
                                    </div>
                                    <div class="success-metrics">
                                        <h6> Success Metrics:</h6>
                                        <ul>
                                            ${goal.successMetrics.map(metric => `<li>${metric}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                if (data.goals.longTerm && data.goals.longTerm.length > 0) {
                    html += '<div class="goal-category"><h5> Long Term (1-3 years)</h5>';
                    data.goals.longTerm.forEach(goal => {
                        html += `
                            <div class="goal-item">
                                <h6>${goal.title}</h6>
                                <p><strong>Description:</strong> ${goal.description}</p>
                                <p><strong>Timeline:</strong> ${goal.timeline}</p>
                                <div class="goal-details">
                                    <div class="action-steps">
                                        <h6> Action Steps:</h6>
                                        <ol>
                                            ${goal.actionSteps.map(step => `<li>${step}</li>`).join('')}
                                        </ol>
                                    </div>
                                    <div class="success-metrics">
                                        <h6> Success Metrics:</h6>
                                        <ul>
                                            ${goal.successMetrics.map(metric => `<li>${metric}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            // Learning Path
            if (data.learningPath) {
                html += `
                    <div class="career-section learning-path">
                        <h4> Learning Path</h4>
                        <div class="learning-grid">
                            <div class="learning-category">
                                <h5> Certifications</h5>
                                <ul>
                                    ${data.learningPath.certifications.map(cert => `<li>${cert}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="learning-category">
                                <h5> Courses</h5>
                                <ul>
                                    ${data.learningPath.courses.map(course => `<li>${course}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="learning-category">
                                <h5> Resources</h5>
                                <ul>
                                    ${data.learningPath.resources.map(resource => `<li>${resource}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Networking
            if (data.networking) {
                html += `
                    <div class="career-section networking">
                        <h4> Networking Strategy</h4>
                        <div class="networking-grid">
                            <div class="networking-category">
                                <h5> Mentorship</h5>
                                <ul>
                                    ${data.networking.mentorship.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="networking-category">
                                <h5> Events</h5>
                                <ul>
                                    ${data.networking.events.map(event => `<li>${event}</li>`).join('')}
                                </ul>
                            </div>
                            <div class="networking-category">
                                <h5> Platforms</h5>
                                <ul>
                                    ${data.networking.platforms.map(platform => `<li>${platform}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Format job analytics data
        function formatJobAnalytics(data) {
            if (typeof data === 'string') {
                return data.replace(/\n/g, '<br>');
            }
            
            let html = '<div class="job-analytics">';
            
            // Market Overview
            if (data.marketOverview) {
                html += `
                    <div class="analytics-section">
                        <h4> Market Overview</h4>
                        
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <h5> Employment Trends</h5>
                                <ul>
                                    ${data.marketOverview.employmentTrends.map(trend => `<li>${trend}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="analytics-card">
                                <h5> Growth Industries</h5>
                                <ul>
                                    ${data.marketOverview.growthIndustries.map(industry => `<li>${industry}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="analytics-card">
                                <h5> Remote Work Statistics</h5>
                                <div class="remote-stats">
                                    <p><strong>Percentage:</strong> ${data.marketOverview.remoteWorkStats.percentage}</p>
                                    <p><strong>Trend:</strong> ${data.marketOverview.remoteWorkStats.trend}</p>
                                    <p><strong>Top Remote Roles:</strong></p>
                                    <ul>
                                        ${data.marketOverview.remoteWorkStats.topRemoteRoles.map(role => `<li>${role}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // In-Demand Skills
            if (data.inDemandSkills) {
                html += `
                    <div class="analytics-section">
                        <h4> In-Demand Skills</h4>
                        
                        <div class="skills-grid">
                            <div class="skills-category">
                                <h5> Technical Skills</h5>
                                <ul>
                                    ${data.inDemandSkills.technical.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="skills-category">
                                <h5> Soft Skills</h5>
                                <ul>
                                    ${data.inDemandSkills.soft.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="skills-category">
                                <h5> Emerging Skills</h5>
                                <ul>
                                    ${data.inDemandSkills.emerging.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Salary Trends
            if (data.salaryTrends) {
                html += `
                    <div class="analytics-section">
                        <h4> Salary Trends</h4>
                        
                        <div class="salary-info">
                            ${data.salaryTrends.byRole.map(role => `
                                <div class="salary-role">
                                    <h5>${role.role}</h5>
                                    <div class="salary-levels">
                                        <span class="salary-level"><strong>Entry Level:</strong> ${role.entryLevel}</span>
                                        <span class="salary-level"><strong>Mid Level:</strong> ${role.midLevel}</span>
                                        <span class="salary-level"><strong>Senior:</strong> ${role.senior}</span>
                                    </div>
                                </div>
                            `).join('')}
                            
                            <div class="salary-insights">
                                <h5> Geographic Variations</h5>
                                <ul>
                                    ${data.salaryTrends.geographicVariations.map(variation => `<li>${variation}</li>`).join('')}
                                </ul>
                                
                                <h5> Experience Impact</h5>
                                <p>${data.salaryTrends.experienceImpact}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Job Opportunities
            if (data.jobOpportunities) {
                html += `
                    <div class="analytics-section">
                        <h4> Job Opportunities</h4>
                        
                        <div class="opportunities-grid">
                            <div class="opportunity-card">
                                <h5> High Growth Sectors</h5>
                                <ul>
                                    ${data.jobOpportunities.highGrowthSectors.map(sector => `<li>${sector}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="opportunity-card">
                                <h5> Remote Availability</h5>
                                <p class="remote-availability ${data.jobOpportunities.remoteAvailability.toLowerCase()}">${data.jobOpportunities.remoteAvailability}</p>
                            </div>
                            
                            <div class="opportunity-card">
                                <h5> Entry vs Senior Level</h5>
                                <div class="level-comparison">
                                    <p><strong>Entry Level:</strong> ${data.jobOpportunities.entryVsSenior.entryLevel}</p>
                                    <p><strong>Senior Level:</strong> ${data.jobOpportunities.entryVsSenior.senior}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Career Advice
            if (data.careerAdvice) {
                html += `
                    <div class="analytics-section">
                        <h4> Career Advice</h4>
                        
                        <div class="advice-grid">
                            <div class="advice-category">
                                <h5> Staying Competitive</h5>
                                <ul>
                                    ${data.careerAdvice.stayingCompetitive.map(advice => `<li>${advice}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="advice-category">
                                <h5> Upskilling</h5>
                                <ul>
                                    ${data.careerAdvice.upskilling.map(skill => `<li>${skill}</li>`).join('')}
                                </ul>
                            </div>
                            
                            <div class="advice-category">
                                <h5> Networking</h5>
                                <ul>
                                    ${data.careerAdvice.networking.map(network => `<li>${network}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Format job analytics data
        function formatJobAnalytics(data) {
            if (typeof data === 'string') {
                return data.replace(/\n/g, '<br>');
            }
            
            let html = '<div class="job-analytics">';
            
            // Market Overview
            if (data.marketOverview) {
                html += `
                    <div class="analytics-section">
                        <h4> Market Overview</h4>
                        <div class="analytics-grid">
                            <div class="analytics-card">
                                <h5> Employment Trends</h5>
                                <ul>
                                    ${data.marketOverview.employmentTrends ? data.marketOverview.employmentTrends.map(trend => `<li>${trend}</li>`).join('') : '<li>Data not available</li>'}
                                </ul>
                            </div>
                            <div class="analytics-card">
                                <h5> Growth Industries</h5>
                                <ul>
                                    ${data.marketOverview.growthIndustries ? data.marketOverview.growthIndustries.map(industry => `<li>${industry}</li>`).join('') : '<li>Data not available</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // In-Demand Skills
            if (data.inDemandSkills) {
                html += `
                    <div class="analytics-section">
                        <h4> In-Demand Skills</h4>
                        <div class="skills-grid">
                            <div class="skills-category">
                                <h5> Technical Skills</h5>
                                <ul>
                                    ${data.inDemandSkills.technical ? data.inDemandSkills.technical.map(skill => `<li>${skill}</li>`).join('') : '<li>Data not available</li>'}
                                </ul>
                            </div>
                            <div class="skills-category">
                                <h5> Soft Skills</h5>
                                <ul>
                                    ${data.inDemandSkills.soft ? data.inDemandSkills.soft.map(skill => `<li>${skill}</li>`).join('') : '<li>Data not available</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Salary Trends
            if (data.salaryTrends) {
                html += `
                    <div class="analytics-section">
                        <h4> Salary Trends</h4>
                        <div class="salary-info">
                            ${data.salaryTrends.byRole ? data.salaryTrends.byRole.map(role => `
                                <div class="salary-role">
                                    <h5>${role.role}</h5>
                                    <div class="salary-levels">
                                        <span class="salary-level"><strong>Entry Level:</strong> ${role.entryLevel}</span>
                                        <span class="salary-level"><strong>Mid Level:</strong> ${role.midLevel}</span>
                                        <span class="salary-level"><strong>Senior:</strong> ${role.senior}</span>
                                    </div>
                                </div>
                            `).join('') : '<p>Salary data not available</p>'}
                        </div>
                    </div>
                `;
            }
            
            // Job Opportunities
            if (data.jobOpportunities) {
                html += `
                    <div class="analytics-section">
                        <h4> Job Opportunities</h4>
                        <div class="opportunities-grid">
                            <div class="opportunity-card">
                                <h5> Market Demand</h5>
                                <p class="demand-level ${data.jobOpportunities.marketDemand.toLowerCase()}">${data.jobOpportunities.marketDemand}</p>
                            </div>
                            
                            <div class="opportunity-card">
                                <h5> Remote Availability</h5>
                                <p class="remote-availability ${data.jobOpportunities.remoteAvailability.toLowerCase()}">${data.jobOpportunities.remoteAvailability}</p>
                            </div>
                            
                            <div class="opportunity-card">
                                <h5> Entry vs Senior Level</h5>
                                <div class="level-comparison">
                                    <p><strong>Entry Level:</strong> ${data.jobOpportunities.entryVsSenior.entryLevel}</p>
                                    <p><strong>Senior Level:</strong> ${data.jobOpportunities.entryVsSenior.senior}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Career Advice
            if (data.careerAdvice) {
                html += `
                    <div class="analytics-section">
                        <h4> Career Advice</h4>
                        <div class="advice-grid">
                            <div class="advice-category">
                                <h5> Staying Competitive</h5>
                                <ul>
                                    ${data.careerAdvice.stayingCompetitive ? data.careerAdvice.stayingCompetitive.map(advice => `<li>${advice}</li>`).join('') : '<li>Advice not available</li>'}
                                </ul>
                            </div>
                            
                            <div class="advice-category">
                                <h5> Upskilling</h5>
                                <ul>
                                    ${data.careerAdvice.upskilling ? data.careerAdvice.upskilling.map(skill => `<li>${skill}</li>`).join('') : '<li>Advice not available</li>'}
                                </ul>
                            </div>
                            
                            <div class="advice-category">
                                <h5> Networking</h5>
                                <ul>
                                    ${data.careerAdvice.networking ? data.careerAdvice.networking.map(network => `<li>${network}</li>`).join('') : '<li>Advice not available</li>'}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function selectPlan(plan) {
            // Handle payment plan selection
            if (plan === 'free') {
                showNotification(' Free trial activated! You have 7 days of full access.', 'success');
            } else if (plan === 'basic') {
                // Redirect to payment gateway for Basic Plan
                showNotification(' Redirecting to payment for Basic Plan ($9.99/month)...', 'info');
                // Here you would integrate with Stripe, PayPal, or your preferred payment gateway
                setTimeout(() => {
                    alert('Payment integration will be configured with your preferred payment gateway (Stripe, PayPal, etc.)');
                }, 1000);
            } else if (plan === 'premium') {
                // Redirect to payment gateway for Premium Plan
                showNotification(' Redirecting to payment for Premium Plan ($19.99/month)...', 'info');
                // Here you would integrate with Stripe, PayPal, or your preferred payment gateway
                setTimeout(() => {
                    alert('Payment integration will be configured with your preferred payment gateway (Stripe, PayPal, etc.)');
                }, 1000);
            }
        }

        // Voice-related functions
        function stopSpeech() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
        }

        // Enhanced Voice Functions with Chat Mode
        function speakText(text, mode = 'general') {
            if (!window.globalVoiceEnabled) return;
            
            // Ensure text is a string and handle different data types
            let cleanText = '';
            
            if (typeof text === 'string') {
                cleanText = text;
            } else if (typeof text === 'object' && text !== null) {
                // Handle JSON objects - try to extract meaningful text
                if (text.message) {
                    cleanText = text.message;
                } else if (text.content) {
                    cleanText = text.content;
                } else if (text.text) {
                    cleanText = text.text;
                } else if (text.result) {
                    cleanText = text.result;
                } else {
                    // Convert object to string representation
                    cleanText = JSON.stringify(text);
                }
            } else if (text === null || text === undefined) {
                console.log('No text to speak - null or undefined');
                return;
            } else {
                // Convert other types to string
                cleanText = String(text);
            }
            
            // Enhanced text cleaning for better speech quality
            // Remove HTML tags
            cleanText = cleanText.replace(/<[^>]*>/g, ' ');
            
            // Remove emojis and special characters
            cleanText = cleanText.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
            
            // Remove extra special characters that can cause speech issues
            cleanText = cleanText.replace(/[^\w\s.,!?;:()\-]/g, ' ');
            
            // Clean up multiple spaces and newlines
            cleanText = cleanText.replace(/\s+/g, ' ').replace(/\n+/g, ' ').trim();
            
            if (!cleanText || cleanText.trim().length === 0) {
                console.log('No text to speak');
                return;
            }

            // Stop any current speech
            stopSpeech();

            // Create utterance with mode-specific settings
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'en-US';
            
            // Chat mode: faster speech for better conversation flow
            if (mode === 'chat') {
                utterance.rate = 1.2; // Faster for chat
                utterance.pitch = 1.1; // Slightly higher pitch for engagement
            } else {
                utterance.rate = 0.9; // Normal speed for other modes
                utterance.pitch = 1.0;
            }
            
            utterance.volume = 0.8;
            
            // Speak the text
            window.speechSynthesis.speak(utterance);
        }

        function speakLastResponse(mode) {
            if (!window.globalVoiceEnabled) return;
            
            let responseText = '';
            let resultElement = null;
            
            switch(mode) {
                case 'chat':
                    resultElement = document.getElementById('chatResult');
                    break;
                case 'resume':
                    resultElement = document.getElementById('resumeResult');
                    break;
                case 'interview':
                    resultElement = document.getElementById('interviewResult');
                    break;
                case 'career':
                    resultElement = document.getElementById('careerResult');
                    break;
                case 'analytics':
                    resultElement = document.getElementById('analyticsResult');
                    break;

                case 'jobSearch':
                    resultElement = document.getElementById('jobSearchResult');
                    break;
                case 'analysis':
                    resultElement = document.getElementById('resumeAnalysisResult');
                    break;
                case 'coverLetter':
                    resultElement = document.getElementById('coverLetterResult');
                    break;
                case 'interviewPractice':
                    resultElement = document.getElementById('interviewPracticeArea');
                    break;
                default:
                    // Try to find element by mode + 'Result'
                    resultElement = document.getElementById(mode + 'Result');
                    if (!resultElement) {
                        // Try to find element by mode
                        resultElement = document.getElementById(mode);
                    }
                    break;
            }
            
            if (resultElement && resultElement.textContent) {
                responseText = resultElement.textContent;
                speakText(responseText, mode);
            } else if (resultElement && resultElement.innerHTML) {
                // Extract text from HTML content
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = resultElement.innerHTML;
                responseText = tempDiv.textContent || tempDiv.innerText || '';
                if (responseText.trim()) {
                    speakText(responseText, mode);
                } else {
                    alert('No response available to speak. Please generate a response first.');
                }
            } else {
                alert('No response available to speak. Please generate a response first.');
            }
        }


        
        // Enhanced File Upload with Analysis
        function uploadFile(file) {
            const formData = new FormData();
            formData.append('document', file);
            
            // Show loading state
            const uploadArea = document.querySelector('.file-upload');
            uploadArea.innerHTML = `
                <div class="upload-loading">
                    <div class="loading-spinner"></div>
                    <p> Uploading and processing document...</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">This may take a few moments for large files</p>
                </div>
            `;
            
            // Clear any previous analysis content
            const analysisContent = document.getElementById('analysisContent');
            if (analysisContent) {
                analysisContent.innerHTML = '';
            }
            
            fetch('/api/upload-document', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Store the uploaded content
                    window.uploadedResumeContent = data.content;
                    
                    // Display the uploaded content in the analysis tab
                    const analysisContent = document.getElementById('analysisContent');
                    if (analysisContent) {
                        analysisContent.innerHTML = `
                            <div class="uploaded-document-preview">
                                <h4> Uploaded Document Preview</h4>
                                <div class="document-content">
                                    <pre style="white-space: pre-wrap; background: rgba(0,0,0,0.1); padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; font-size: 14px; line-height: 1.4;">${data.content}</pre>
                                </div>
                                <p style="margin-top: 15px; color: #64b5f6; font-weight: bold;"> Document uploaded successfully! Now enter the job description below and click "Analyze Resume" to get started.</p>
                                <button onclick="clearUploadedDocument()" class="btn secondary" style="margin-top: 10px;"> Clear Document & Upload New</button>
                            </div>
                        `;
                    }
                    
                    // Reset upload area
                    uploadArea.innerHTML = `
                        <p> Click to upload or drag & drop your resume</p>
                        <p style="font-size: 0.9rem; opacity: 0.7;">Supports PDF, Word, and text files</p>
                        <input type="file" id="resumeFile" accept=".pdf,.docx,.txt" style="display: none;" onchange="handleFileSelect(event)">
                    `;
                    
                    // Show success notification
                    showNotification(' Document uploaded successfully! You can now see the content and enter a job description for analysis.', 'success');
                }
            })
            .catch(error => {
                console.error('Upload error:', error);
                alert('Upload failed. Please try again.');
                
                // Reset upload area
                uploadArea.innerHTML = `
                    <p> Click to upload or drag & drop your resume</p>
                    <p style="font-size: 0.9rem; opacity: 0.7;">Supports PDF, Word, and text files</p>
                    <input type="file" id="resumeFile" accept=".pdf,.docx,.txt" style="display: none;" onchange="handleFileSelect(event)">
                `;
            });
        }
        
        // Optimized resume analysis with better loading states
        async function analyzeResumeWithJobDescription() {
            const jobDesc = document.getElementById('analysisJobDescription').value.trim();
            const resumeContent = window.uploadedResumeContent;
            
            if (!jobDesc || !resumeContent) {
                alert('Please provide both a job description and upload a resume first.');
                return;
            }
            
            showLoading('analysisContent', ' Analyzing resume with AI...');
            
            try {
                const response = await fetch('/api/analyze-resume-with-jd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resumeContent: resumeContent,
                        jobDescription: jobDesc
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const analysisContent = document.getElementById('analysisContent');
                    
                    // Store the analysis result for later use
                    window.resumeAnalysisResult = data.analysis;
                    
                    // Display the analysis with proper formatting
                    let analysisDisplay = '';
                    
                    if (typeof data.analysis === 'object' && data.analysis !== null) {
                        // Handle structured JSON response
                        const analysis = data.analysis;
                        analysisDisplay = `
                            <div class="analysis-result">
                                <h3> Resume Analysis Complete</h3>
                                
                                <!-- Alignment Score -->
                                <div class="analysis-section">
                                    <h4> Alignment Score: ${analysis.alignmentScore?.score || 'N/A'}/10</h4>
                                    <p>${analysis.alignmentScore?.explanation || 'No explanation available'}</p>
                                </div>
                                
                                <!-- Key Strengths -->
                                <div class="analysis-section">
                                    <h4> Key Strengths</h4>
                                    ${analysis.keyStrengths && analysis.keyStrengths.length > 0 ? 
                                        analysis.keyStrengths.map(strength => `
                                            <div class="strength-item">
                                                <strong>${strength.strength}</strong>
                                                <p><em>Evidence:</em> ${strength.evidence}</p>
                                                <p><em>Relevance:</em> ${strength.relevance}</p>
                                            </div>
                                        `).join('') : '<p>No strengths identified</p>'
                                    }
                                </div>
                                
                                <!-- Areas for Improvement -->
                                <div class="analysis-section">
                                    <h4> Areas for Improvement</h4>
                                    ${analysis.areasForImprovement && analysis.areasForImprovement.length > 0 ? 
                                        analysis.areasForImprovement.map(area => `
                                            <div class="improvement-item">
                                                <strong>${area.area}</strong>
                                                <p><em>Current:</em> ${area.currentLevel}</p>
                                                <p><em>Target:</em> ${area.targetLevel}</p>
                                                <p><em>Action:</em> ${area.action}</p>
                                            </div>
                                        `).join('') : '<p>No areas identified</p>'
                                    }
                                </div>
                                
                                <!-- Key Differences -->
                                <div class="analysis-section">
                                    <h4> Key Differences</h4>
                                    ${analysis.keyDifferences && analysis.keyDifferences.length > 0 ? 
                                        analysis.keyDifferences.map(diff => `
                                            <div class="difference-item">
                                                <strong>${diff.missingSkill}</strong>
                                                <p><em>Importance:</em> ${diff.importance}</p>
                                                <p><em>How to Acquire:</em> ${diff.howToAcquire}</p>
                                            </div>
                                        `).join('') : '<p>No differences identified</p>'
                                    }
                                </div>
                                
                                <!-- Recommendations -->
                                <div class="analysis-section">
                                    <h4> Recommendations</h4>
                                    ${analysis.recommendations && analysis.recommendations.length > 0 ? 
                                        analysis.recommendations.map(rec => `
                                            <div class="recommendation-item">
                                                <strong>${rec.action}</strong>
                                                <p><em>Priority:</em> <span class="priority-${rec.priority?.toLowerCase()}">${rec.priority}</span></p>
                                                <p><em>Timeline:</em> ${rec.timeline}</p>
                                                <p><em>Expected Outcome:</em> ${rec.expectedOutcome}</p>
                                            </div>
                                        `).join('') : '<p>No recommendations available</p>'
                                    }
                                </div>
                                
                                <!-- Overall Assessment -->
                                <div class="analysis-section">
                                    <h4> Overall Assessment</h4>
                                    <p>${analysis.overallAssessment || 'No overall assessment available'}</p>
                                </div>
                                
                                <div class="action-buttons">
                                    <button onclick="analyzeResumeWithJobDescription()" class="btn secondary"> Re-analyze</button>
                                </div>
                            </div>
                        `;
                    } else if (typeof data.analysis === 'string') {
                        // Handle string response (fallback)
                        analysisDisplay = `
                            <div class="analysis-result">
                                <h3> Resume Analysis Complete</h3>
                                <div class="analysis-content">
                                    ${data.analysis.replace(/\n/g, '<br>')}
                                </div>
                                <div class="action-buttons">
                                    <button onclick="analyzeResumeWithJobDescription()" class="btn secondary"> Re-analyze</button>
                                </div>
                            </div>
                        `;
                    } else {
                        // Handle unexpected response format
                        analysisDisplay = `
                            <div class="analysis-result">
                                <h3> Resume Analysis Complete</h3>
                                <div class="analysis-content">
                                    <p>Analysis completed successfully. You can now go to the Resume & Cover Letter Generation tab to create new documents.</p>
                                </div>
                                <div class="action-buttons">
                                    <button onclick="analyzeResumeWithJobDescription()" class="btn secondary"> Re-analyze</button>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Display the analysis
                    analysisContent.innerHTML = analysisDisplay;
                    analysisContent.style.display = 'block';
                    
                    // Show success notification
                    showNotification(' Resume analysis completed successfully!', 'success');
                    
                } else {
                    throw new Error(data.error || 'Analysis failed');
                }
            } catch (error) {
                console.error('Analysis error:', error);
                hideLoading('analysisContent');
                const analysisContent = document.getElementById('analysisContent');
                analysisContent.innerHTML = `
                    <div class="error-message">
                        <p> Analysis failed: ${error.message}</p>
                        <button onclick="analyzeResumeWithJobDescription()" class="btn"> Try Again</button>
                    </div>
                `;
                analysisContent.style.display = 'block';
            } finally {
                hideLoading('analysisContent');
            }

        
        // Optimized Resume Optimization with loading states
        async function optimizeResume() {
            const jobDesc = document.getElementById('jobDescription').value.trim();
            const resumeContent = window.uploadedResumeContent;
            
            if (!jobDesc || !resumeContent) {
                alert('Please provide both a job description and upload a resume first.');
                return;
            }
            
            showLoading('resumeResult', ' Optimizing resume with AI...');
            
            try {
                const response = await fetch('/api/update-resume', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        resumeText: resumeContent,
                        jobDescription: jobDesc,
                        jobTitle: document.getElementById('jobTitle').value || 'Software Developer',
                        companyName: document.getElementById('companyName').value || 'Tech Company'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const optimizedResume = data.result || data.optimizedResume;
                    window.optimizedResumeContent = optimizedResume;
                    
                    // Display the optimized resume with proper formatting
                    const optimizedContent = document.getElementById('optimizedContent');
                    optimizedContent.innerHTML = `
                        <div class="optimization-result">
                            <h3> Resume Optimized Successfully!</h3>
                            <div class="resume-content">
                                ${optimizedResume.replace(/\n/g, '<br>')}
                            </div>
                            <div class="action-buttons">
                                <button onclick="downloadResume()" class="btn primary"> Download Resume</button>
                                <button onclick="copyToClipboard()" class="btn secondary"> Copy to Clipboard</button>
                                <button onclick="generateCoverLetter()" class="btn"> Generate Cover Letter</button>
                            </div>
                        </div>
                    `;
                    
                    // Show the result area
                    document.getElementById('resumeResult').style.display = 'block';
                    
                    // Show cover letter section
                    document.getElementById('coverLetterSection').style.display = 'block';
                    
                    // Show success notification
                    showNotification(' Resume optimized successfully! You can now download it or generate a cover letter.', 'success');
                    
                    // Cover letter generation is now user-initiated only
                } else {
                    document.getElementById('resumeResult').innerHTML = `
                        <div class="error-message">
                            <p> Optimization failed: ${data.error || 'Unknown error'}</p>
                            <button onclick="optimizeResume()" class="btn"> Try Again</button>
                        </div>
                    `;
                    document.getElementById('resumeResult').style.display = 'block';
                }
            } catch (error) {
                console.error('Optimization error:', error);
                document.getElementById('resumeResult').innerHTML = `
                    <div class="error-message">
                        <p> Optimization failed: ${error.message}</p>
                        <button onclick="optimizeResume()" class="btn"> Try Again</button>
                    </div>
                `;
                document.getElementById('resumeResult').style.display = 'block';
            } finally {
                hideLoading('resumeResult');
            }
        }
        
        // Enhanced Cover Letter Generation
        function generateCoverLetter() {
            const jobDesc = document.getElementById('jobDescription').value.trim();
            
            if (!jobDesc) {
                alert('Please enter a job description first.');
                return;
            }
            
            showLoading('coverLetterResult', ' Generating personalized cover letter...');
            
            // Show the result area
            const resultDiv = document.getElementById('coverLetterResult');
            resultDiv.style.display = 'block';
            
            fetch('/api/generate-cover-letter', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    resumeText: window.uploadedResumeContent || 'Generate a professional cover letter', 
                    jobDescription: jobDesc, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const coverLetter = data.result || data.coverLetter;
                    window.coverLetterContent = coverLetter; // Store for download
                    
                    contentDiv.innerHTML = `
                        <div class="cover-letter-content">
                            <h3> Your Cover Letter</h3>
                            <div class="letter-text">
                                ${coverLetter.replace(/\n/g, '<br>')}
                            </div>
                            <div class="action-buttons">
                                <button onclick="downloadCoverLetter()" class="btn primary"> Download Cover Letter</button>
                                <button onclick="copyCoverLetterToClipboard()" class="btn secondary"> Copy to Clipboard</button>
                            </div>
                        </div>
                    `;
                    
                    // Show voice controls
                    const voiceControls = resultDiv.querySelector('.voice-controls');
                    if (voiceControls) {
                        voiceControls.style.display = 'flex';
                    }
                    
                    // Show success notification
                    showNotification(' Cover letter generated successfully! You can now download it.', 'success');
                } else {
                    contentDiv.innerHTML = '<p> Cover letter generation failed. Please try again.</p>';
                }
            })
            .catch(error => {
                console.error('Cover letter error:', error);
                contentDiv.innerHTML = '<p> Error: Unable to generate cover letter. Please try again.</p>';
            });
        }
        
        // Interview Practice System
        let currentInterviewQuestions = [];
        let currentQuestionIndex = 0;
        let interviewSessionActive = false;
        let interviewAnswers = [];
        
        function startInterviewPractice() {
            const jobTitle = document.getElementById('jobTitle').value.trim();
            const jobDesc = document.getElementById('interviewJobDesc').value.trim();
            
            if (!jobTitle || !jobDesc) {
                alert('Please enter both job title and description to start practice.');
                return;
            }
            
            // Generate interview questions first
            fetch('/api/interview-prep', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    jobTitle, 
                    jobDescription: jobDesc, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                if (!data || !data.result) {
                    throw new Error('No interview questions received from server');
                }
                
                // Parse questions from the response
                const questions = data.result.split('\n').filter(q => q.trim().length > 0 && q.includes('?'));
                
                if (questions.length === 0) {
                    throw new Error('No valid questions found in response');
                }
                
                currentInterviewQuestions = questions;
                currentQuestionIndex = 0;
                interviewSessionActive = true;
                interviewAnswers = [];
                
                // Show practice area
                document.getElementById('interviewPracticeArea').style.display = 'block';
                document.getElementById('interviewResult').style.display = 'none';
                
                // Display first question
                displayNextQuestion();
            })
            .catch(error => {
                console.error('Interview prep error:', error);
                alert('Error: Unable to generate interview questions. Please try again.');
            });
        }
        
        function displayNextQuestion() {
            if (currentQuestionIndex < currentInterviewQuestions.length) {
                const question = currentInterviewQuestions[currentQuestionIndex];
                document.getElementById('currentQuestion').innerHTML = `
                    <h5>Question ${currentQuestionIndex + 1} of ${currentInterviewQuestions.length}</h5>
                    <p><strong>${question}</strong></p>
                `;
                
                // Update progress
                document.getElementById('interviewProgress').innerHTML = `
                    <div style="margin: 20px 0; padding: 15px; background: rgba(100, 181, 246, 0.1); border-radius: 10px;">
                        <p><strong>Progress:</strong> ${currentQuestionIndex + 1} of ${currentInterviewQuestions.length} questions answered</p>
                        <div style="width: 100%; height: 10px; background: rgba(255, 255, 255, 0.2); border-radius: 5px; overflow: hidden;">
                            <div style="width: ${((currentQuestionIndex + 1) / currentInterviewQuestions.length) * 100}%; height: 100%; background: #64b5f6; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
                
                // Clear previous answer and feedback
                document.getElementById('interviewAnswer').value = '';
                document.getElementById('interviewFeedback').style.display = 'none';
                
                // Speak the question
                speakText(question, 'interview');
            } else {
                // Interview complete - show comprehensive feedback
                showInterviewSummary();
            }
        }
        
        function submitInterviewAnswer() {
            const answer = document.getElementById('interviewAnswer').value.trim();
            
            if (!answer) {
                alert('Please provide an answer before submitting.');
                return;
            }
            
            // Store the answer
            interviewAnswers.push({
                question: currentInterviewQuestions[currentQuestionIndex],
                answer: answer
            });
            
            // Move to next question
            currentQuestionIndex++;
            displayNextQuestion();
        }
        
        function showInterviewSummary() {
            // Hide answer area and show feedback
            document.getElementById('yourAnswerArea').style.display = 'none';
            document.getElementById('interviewProgress').style.display = 'none';
            
            // Show comprehensive feedback
            const feedbackDiv = document.getElementById('interviewFeedback');
            feedbackDiv.style.display = 'block';
            feedbackDiv.innerHTML = '<h5> Generating comprehensive feedback...</h5>';
            
            // Generate comprehensive feedback using all answers
            const feedbackPrompt = `I just completed an interview practice session. Here are my questions and answers:

${interviewAnswers.map((qa, index) => `Question ${index + 1}: ${qa.question}
My Answer: ${qa.answer}`).join('\n\n')}

Please provide comprehensive feedback including:
1. Overall performance assessment
2. Strengths in my answers
3. Areas for improvement
4. Specific suggestions for each answer
5. Tips for future interviews
6. Overall score out of 10

Format this as a structured feedback report.`;

            fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: feedbackPrompt, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                feedbackDiv.innerHTML = `
                    <h5> Interview Practice Complete!</h5>
                    <h6> Comprehensive Feedback Report:</h6>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 10px;">
                        ${data.result.replace(/\n/g, '<br>')}
                    </div>
                    <button class="btn" onclick="restartInterview()" style="margin-top: 15px;"> Practice Again</button>
                `;
                
                // Speak the feedback
                speakText(data.result, 'interview');
                
                interviewSessionActive = false;
            })
            .catch(error => {
                console.error('Feedback error:', error);
                feedbackDiv.innerHTML = `
                    <h5> Interview Practice Complete!</h5>
                    <p>Great job completing all ${interviewAnswers.length} questions!</p>
                    <p>You've practiced with real interview questions and provided thoughtful answers.</p>
                    <button class="btn" onclick="restartInterview()" style="margin-top: 15px;"> Practice Again</button>
                `;
                interviewSessionActive = false;
            });
        }
        
        function restartInterview() {
            // Reset everything and hide practice area
            currentQuestionIndex = 0;
            interviewSessionActive = false;
            interviewAnswers = [];
            
            document.getElementById('interviewPracticeArea').style.display = 'none';
            document.getElementById('yourAnswerArea').style.display = 'block';
            document.getElementById('interviewProgress').style.display = 'block';
            document.getElementById('interviewFeedback').style.display = 'none';
            document.getElementById('interviewAnswer').value = '';
        }
        
        function speakLastQuestion() {
            if (currentQuestionIndex < currentInterviewQuestions.length) {
                const question = currentInterviewQuestions[currentQuestionIndex];
                speakText(question, 'interview');
            }
        }
        
        // Enhanced Voice Functions with Chat Mode
        function speakText(text, mode = 'general') {
            if (!window.globalVoiceEnabled) return;
            
            // Ensure text is a string and handle different data types
            let cleanText = '';
            
            if (typeof text === 'string') {
                cleanText = text;
            } else if (typeof text === 'object' && text !== null) {
                // Handle JSON objects - try to extract meaningful text
                if (text.message) {
                    cleanText = text.message;
                } else if (text.content) {
                    cleanText = text.content;
                } else if (text.text) {
                    cleanText = text.text;
                } else if (text.result) {
                    cleanText = text.result;
                } else {
                    // Convert object to string representation
                    cleanText = JSON.stringify(text);
                }
            } else if (text === null || text === undefined) {
                console.log('No text to speak - null or undefined');
                return;
            } else {
                // Convert other types to string
                cleanText = String(text);
            }
            
            // Enhanced text cleaning for better speech quality
            // Remove HTML tags
            cleanText = cleanText.replace(/<[^>]*>/g, ' ');
            
            // Remove emojis and special characters
            cleanText = cleanText.replace(/[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]/gu, '');
            
            // Remove extra special characters that can cause speech issues
            cleanText = cleanText.replace(/[^\w\s.,!?;:()\-]/g, ' ');
            
            // Clean up multiple spaces and newlines
            cleanText = cleanText.replace(/\s+/g, ' ').replace(/\n+/g, ' ').trim();
            
            if (!cleanText || cleanText.trim().length === 0) {
                console.log('No text to speak');
                return;
            }

            // Stop any current speech
            stopSpeech();

            // Create utterance with mode-specific settings
            const utterance = new SpeechSynthesisUtterance(cleanText);
            utterance.lang = 'en-US';
            
            // Chat mode: faster speech for better conversation flow
            if (mode === 'chat') {
                utterance.rate = 1.2; // Faster for chat
                utterance.pitch = 1.1; // Slightly higher pitch for engagement
            } else {
                utterance.rate = 0.9; // Normal speed for other modes
                utterance.pitch = 1.0;
            }
            
            utterance.volume = 0.8;
            
            // Speak the text
            window.speechSynthesis.speak(utterance);
        }
        
        // Chat Memory System (Last 50 chats)
        let chatMemory = [];
        const MAX_CHAT_MEMORY = 50;
        let lastResponseHash = ''; // Track last response to prevent repetition
        
        // Rate Limiting
        let lastRequestTime = 0;
        const MIN_REQUEST_INTERVAL = 2000; // 2 seconds between requests
        
        function addToChatMemory(message, response) {
            // Create a hash of the response to detect repetition
            const responseHash = btoa(response.substring(0, 100)).replace(/[^a-zA-Z0-9]/g, '');
            
            // Check if this response is too similar to the last one
            if (responseHash === lastResponseHash) {
                console.log(' Detected repetitive response, not adding to memory');
                return;
            }
            
            chatMemory.push({
                message: message,
                response: response,
                timestamp: new Date().toISOString(),
                hash: responseHash
            });
            
            // Keep only last 10 chats
            if (chatMemory.length > MAX_CHAT_MEMORY) {
                chatMemory.shift();
            }
            
            // Update last response hash
            lastResponseHash = responseHash;
        }
        
        // Enhanced Chat with Memory
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Rate limiting - prevent rapid successive requests
            const now = Date.now();
            if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {
                const remainingTime = Math.ceil((MIN_REQUEST_INTERVAL - (now - lastRequestTime)) / 1000);
                displayResult('chatResult', ` Please wait ${remainingTime} seconds before sending another message. This prevents API rate limit errors.`);
                return;
            }
            lastRequestTime = now;
            
            // Add minimal context from memory to prevent repetition
            let contextMessage = message;
            if (chatMemory.length > 0) {
                // Include more context for longer conversations but keep it manageable
                const recentChats = chatMemory.slice(-5); // Last 5 chats for better context
                const uniqueContext = recentChats.map(chat => `Previous Q: ${chat.message}`).join('\n');
                contextMessage = `Previous questions for context:\n${uniqueContext}\n\nCurrent question: ${message}\n\nPlease provide a fresh, unique answer that builds upon but doesn't repeat previous responses.`;
            }
            
            fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    message: contextMessage, 
                    userId: 'user123' 
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Chat response:', data);
                
                // Handle different response formats - extract and format the content
                let responseContent;
                if (data.result && data.result.answer) {
                    // Extract the answer from the nested result structure and format it
                    responseContent = formatChatResponse(data.result);
                } else if (data.result && typeof data.result === 'string') {
                    responseContent = data.result;
                } else if (data.response) {
                    responseContent = data.response;
                } else if (data.message) {
                    responseContent = data.message;
                } else if (typeof data === 'string') {
                    responseContent = data;
                } else {
                    // Format the entire response object
                    responseContent = formatChatResponse(data);
                }
                
                // Add to memory
                addToChatMemory(message, responseContent);
                
                // Display result
                displayResult('chatResult', responseContent);
                input.value = '';
                
                // Speak response in chat mode
                speakText(responseContent, 'chat');
                
                // Debug: show what was extracted
                console.log('Extracted response content:', responseContent);
                console.log('Type of response content:', typeof responseContent);
            })
            .catch(error => {
                console.error('Chat error:', error);
                let errorMessage = 'Error: Unable to get response. Please try again.';
                
                // Handle specific error types
                if (error.message && error.message.includes('rate limit')) {
                    errorMessage = ' Rate limit exceeded. Please wait 2 seconds before sending another message. This prevents API errors.';
                } else if (error.message && error.message.includes('429')) {
                    errorMessage = ' Too many requests. Please wait a moment before trying again.';
                }
                
                displayResult('chatResult', errorMessage);
            });
        }
        

        
        // Update motivational message daily
        function updateMotivationalMessage() {
            const messages = [
                " <strong>Welcome to your AI Career Coach!</strong> <br>Ready to take your career to the next level? Let's make it happen together!",
                " <strong>Your career journey starts here!</strong> <br>Every expert was once a beginner. Let's build your success story!",
                " <strong>You've got this!</strong> <br>Success is not final, failure is not fatal. It's the courage to continue that counts!",
                " <strong>Focus on progress, not perfection!</strong> <br>Small steps every day lead to big changes over time!",
                " <strong>Turn your dreams into goals!</strong> <br>Dream big, work hard, stay focused, and surround yourself with good people!"
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            document.getElementById('motivationalMessage').innerHTML = randomMessage;
        }
        
        // Initialize theme from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            initializeVoiceRecognition();
            // Initialize global voice state
            window.globalVoiceEnabled = true;
            
            // Update motivational message
            updateMotivationalMessage();
            
            // Update motivational message every day
            setInterval(updateMotivationalMessage, 24 * 60 * 60 * 1000);
        });

        // Add loading state management
        let isLoading = false;

        function showLoading(elementId, message = 'Processing...') {
            const element = document.getElementById(elementId);
            if (element) {
                // Store the original content for restoration
                if (!window.originalContent) window.originalContent = {};
                window.originalContent[elementId] = element.innerHTML;
                
                element.innerHTML = `
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <p class="loading-message">${message}</p>
                        <div class="loading-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                `;
                element.style.display = 'block';
                isLoading = true;
            }
        }

        function hideLoading(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                isLoading = false;
                
                // Restore original content if available
                if (window.originalContent && window.originalContent[elementId]) {
                    element.innerHTML = window.originalContent[elementId];
                }
            }
        }

        // Clear uploaded document function
        function clearUploadedDocument() {
            if (confirm('Are you sure you want to clear the uploaded document? You will need to upload it again.')) {
                window.uploadedResumeContent = null;
                const analysisContent = document.getElementById('analysisContent');
                if (analysisContent) {
                    analysisContent.innerHTML = '';
                }
                showNotification(' Document cleared. You can now upload a new document.', 'info');
            }
        }
        
        // Add notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" class="close-btn"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Download functions for resume and cover letter
        function downloadResume() {
            if (window.optimizedResumeContent) {
                const blob = new Blob([window.optimizedResumeContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'optimized_resume.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification(' Resume downloaded successfully!', 'success');
            } else {
                showNotification(' No optimized resume available to download', 'error');
            }
        }
        
        function downloadCoverLetter() {
            const coverLetterContent = document.querySelector('.letter-text');
            if (coverLetterContent) {
                const text = coverLetterContent.textContent || coverLetterContent.innerText;
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'cover_letter.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification(' Cover letter downloaded successfully!', 'success');
            } else {
                showNotification(' No cover letter available to download', 'error');
            }
        }
        
        function copyToClipboard() {
            const content = window.optimizedResumeContent || '';
            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    showNotification(' Resume copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification(' Failed to copy to clipboard', 'error');
                });
            } else {
                showNotification(' No content available to copy', 'error');
            }
        }

        function copyCoverLetterToClipboard() {
            const content = window.coverLetterContent || '';
            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    showNotification(' Cover letter copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification(' Failed to copy to clipboard', 'error');
                });
            } else {
                showNotification(' No cover letter available to copy', 'error');
            }
        }


        
        // Retry mechanism for rate limiting
        let retryCount = 0;
        const maxRetries = 3;

        // Generate Resume Only
        function generateResume() {
            console.log(' Starting resume generation...');
            
            // Check if we're on the correct tab
            const resumeTab = document.getElementById('resumeGeneration');
            if (!resumeTab || !resumeTab.classList.contains('active')) {
                showNotification(' Please go to the Resume Generation tab first', 'error');
                return;
            }
            
            const jobDescription = document.getElementById('resumeJobDescription').value.trim();
            if (!jobDescription) {
                showNotification(' Please enter a job description first', 'error');
                return;
            }
            
            showLoading('resumeContent', ' Generating new resume...');
            
            fetch('/api/generate-resume-and-cover-letter', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    resumeContent: window.uploadedResumeContent || "Experienced professional seeking new opportunities",
                    jobDescription: jobDescription
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading('resumeContent');
                
                if (data.success) {
                    window.generatedResumeContent = data.resume;
                    
                    const resumeContentElement = document.getElementById('resumeContent');
                    const resumeResultElement = document.getElementById('resumeResult');
                    
                    if (resumeContentElement && resumeResultElement) {
                        resumeContentElement.innerHTML = `
                            <div class="resume-section">
                                <h4> Generated Resume</h4>
                                <div class="resume-text">
                                    ${(data.resume || '').replace(/\n/g, '<br>')}
                                </div>
                                <div class="action-buttons">
                                    <button onclick="downloadResumeAsWordEnhanced()" class="btn primary"> Download as Word</button>
                                    <button onclick="downloadResumeAsPDF()" class="btn primary"> Download as PDF</button>
                                    <button onclick="copyResumeToClipboard()" class="btn secondary"> Copy Resume</button>
                                </div>
                            </div>
                        `;
                        
                        resumeResultElement.style.display = 'block';
                        showNotification(' Resume generated successfully!', 'success');
                    }
                } else {
                    showNotification(' Failed to generate resume: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                hideLoading('resumeContent');
                console.error('Resume generation error:', error);
                showNotification(' Error generating resume: ' + error.message, 'error');
            });
        }
        
        // Generate Cover Letter Only
        function generateCoverLetter() {
            console.log(' Starting cover letter generation...');
            
            // Check if we're on the correct tab
            const coverLetterTab = document.getElementById('coverLetterGeneration');
            if (!coverLetterTab || !coverLetterTab.classList.contains('active')) {
                showNotification(' Please go to the Cover Letter Generation tab first', 'error');
                return;
            }
            
            const jobDescription = document.getElementById('coverLetterJobDescription').value.trim();
            if (!jobDescription) {
                showNotification(' Please enter a job description first', 'error');
                return;
            }
            
            showLoading('coverLetterContent', ' Generating new cover letter...');
            
            fetch('/api/generate-resume-and-cover-letter', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    resumeContent: window.uploadedResumeContent || "Experienced professional seeking new opportunities",
                    jobDescription: jobDescription
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoading('coverLetterContent');
                
                if (data.success) {
                    window.generatedCoverLetterContent = data.coverLetter;
                    
                    const coverLetterContentElement = document.getElementById('coverLetterContent');
                    const coverLetterResultElement = document.getElementById('coverLetterResult');
                    
                    if (coverLetterContentElement && coverLetterResultElement) {
                        coverLetterContentElement.innerHTML = `
                            <div class="cover-letter-section">
                                <h4> Generated Cover Letter</h4>
                                <div class="letter-text">
                                    ${(data.coverLetter || '').replace(/\n/g, '<br>')}
                                </div>
                                <div class="action-buttons">
                                    <button onclick="downloadCoverLetterAsWordEnhanced()" class="btn primary"> Download as Word</button>
                                    <button onclick="downloadCoverLetterAsPDF()" class="btn primary"> Download as PDF</button>
                                    <button onclick="copyCoverLetterToClipboard()" class="btn secondary"> Copy Cover Letter</button>
                                </div>
                            </div>
                        `;
                        
                        coverLetterResultElement.style.display = 'block';
                        showNotification(' Cover letter generated successfully!', 'success');
                    }
                } else {
                    showNotification(' Failed to generate cover letter: ' + (data.error || 'Unknown error'), 'error');
                }
            })
            .catch(error => {
                hideLoading('coverLetterContent');
                console.error('Cover letter generation error:', error);
                showNotification(' Error generating cover letter: ' + error.message, 'error');
            });
        }

        function downloadGeneratedResume() {
            const content = window.generatedResumeContent || '';
            if (content) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'generated_resume.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showNotification(' Resume downloaded successfully!', 'success');
            } else {
                showNotification(' No resume available to download', 'error');
            }
        }

        function copyGeneratedResumeToClipboard() {
            const content = window.generatedResumeContent || '';
            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    showNotification(' Resume copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification(' Failed to copy to clipboard', 'error');
                });
            } else {
                showNotification(' No resume available to copy', 'error');
            }
        }

        function downloadGeneratedCoverLetter() {
            const content = window.generatedCoverLetterContent || '';
            if (content) {
                const blob = new Blob([content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'generated_cover_letter.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showNotification(' Cover letter downloaded successfully!', 'success');
            } else {
                showNotification(' No cover letter available to download', 'error');
            }
        }

        function copyGeneratedCoverLetterToClipboard() {
            const content = window.generatedCoverLetterContent || '';
            if (content) {
                navigator.clipboard.writeText(content).then(() => {
                    showNotification(' Cover letter copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification(' Failed to copy to clipboard', 'error');
                });
            } else {
                showNotification(' No cover letter available to copy', 'error');
            }
        }
        
        // Download Resume as Word Document
        function downloadResumeAsWord() {
            if (!window.generatedResumeContent) {
                showNotification(' No resume content to download', 'error');
                return;
            }
            
            // Check if docx library is loaded
            if (!librariesLoaded.docx) {
                console.warn('docx library not loaded, using fallback method');
                showNotification(' Using Word-compatible HTML format (opens in Word)', 'info');
                downloadAsSimpleWord(window.generatedResumeContent, 'Professional_Resume.docx');
                return;
            }
            
            try {
                const { Document, Packer, Paragraph, TextRun, HeadingLevel } = docx;
                
                // Create paragraphs from content
                const paragraphs = [];
                
                // Add title
                paragraphs.push(new Paragraph({
                    text: "Professional Resume",
                    heading: HeadingLevel.HEADING_1,
                    spacing: { after: 200 }
                }));
                
                // Add content lines
                const lines = window.generatedResumeContent.split('\n').filter(line => line.trim().length > 0);
                lines.forEach(line => {
                    if (line.trim()) {
                        paragraphs.push(new Paragraph({
                            children: [new TextRun({ text: line.trim() })],
                            spacing: { after: 100 }
                        }));
                    }
                });
                
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: paragraphs
                    }]
                });
                
                // Generate and download
                Packer.toBlob(doc).then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Professional_Resume.docx';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    showNotification(' Resume downloaded as Word document!', 'success');
                }).catch(error => {
                    console.error('Error generating Word blob:', error);
                    showNotification(' Error generating Word document, using fallback', 'warning');
                    downloadAsSimpleWord(window.generatedResumeContent, 'Professional_Resume.docx');
                });
                
            } catch (error) {
                console.error('Error creating Word document:', error);
                showNotification(' Error creating Word document, using fallback', 'warning');
                downloadAsSimpleWord(window.generatedResumeContent, 'Professional_Resume.docx');
            }
        }
        
        // Download Resume as PDF
        function downloadResumeAsPDF() {
            if (!window.generatedResumeContent) {
                showNotification(' No resume content to download', 'error');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const lines = doc.splitTextToSize(window.generatedResumeContent, 180);
                let y = 20;
                
                doc.setFontSize(20);
                doc.text('Professional Resume', 105, y, { align: 'center' });
                y += 20;
                
                doc.setFontSize(12);
                doc.text(lines, 15, y);
                
                doc.save('Professional_Resume.pdf');
                showNotification(' Resume downloaded as PDF!', 'success');
            } catch (error) {
                console.error('Error creating PDF:', error);
                showNotification(' Error creating PDF', 'error');
            }
        }
        
        // Download Cover Letter as Word Document
        function downloadCoverLetterAsWord() {
            if (!window.generatedCoverLetterContent) {
                showNotification(' No cover letter content to download', 'error');
                return;
            }
            
            // Check if docx library is loaded
            if (!librariesLoaded.docx) {
                console.warn('docx library not loaded, using fallback method');
                showNotification(' Using Word-compatible HTML format (opens in Word)', 'info');
                downloadAsSimpleWord(window.generatedCoverLetterContent, 'Cover_Letter.docx');
                return;
            }
            
            try {
                const { Document, Packer, Paragraph, TextRun, HeadingLevel } = docx;
                
                // Create paragraphs from content
                const paragraphs = [];
                
                // Add title
                paragraphs.push(new Paragraph({
                    text: "Cover Letter",
                    heading: HeadingLevel.HEADING_1,
                    spacing: { after: 200 }
                }));
                
                // Add content lines
                const lines = window.generatedCoverLetterContent.split('\n').filter(line => line.trim().length > 0);
                lines.forEach(line => {
                    if (line.trim()) {
                        paragraphs.push(new Paragraph({
                            children: [new TextRun({ text: line.trim() })],
                            spacing: { after: 100 }
                        }));
                    }
                });
                
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: paragraphs
                    }]
                });
                
                // Generate and download
                Packer.toBlob(doc).then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'Cover_Letter.docx';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    showNotification(' Cover letter downloaded as Word document!', 'success');
                }).catch(error => {
                    console.error('Error generating Word blob:', error);
                    showNotification(' Error generating Word document, using fallback', 'warning');
                    downloadAsSimpleWord(window.generatedCoverLetterContent, 'Cover_Letter.docx');
                });
                
            } catch (error) {
                console.error('Error creating Word document:', error);
                showNotification(' Error creating Word document, using fallback', 'warning');
                downloadAsSimpleWord(window.generatedCoverLetterContent, 'Cover_Letter.docx');
            }
        }
        
        // Download Cover Letter as PDF
        function downloadCoverLetterAsPDF() {
            if (!window.generatedCoverLetterContent) {
                showNotification(' No cover letter content to download', 'error');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text('Cover Letter', 105, 20, { align: 'center' });
                
                const lines = doc.splitTextToSize(window.generatedCoverLetterContent, 180);
                doc.setFontSize(12);
                doc.text(lines, 15, 40);
                
                doc.save('Cover_Letter.pdf');
                showNotification(' Cover letter downloaded as PDF!', 'success');
            } catch (error) {
                console.error('Error creating PDF:', error);
                showNotification(' Error creating PDF', 'error');
            }
        }
        
        // Copy Resume to Clipboard
        function copyResumeToClipboard() {
            if (window.generatedResumeContent) {
                navigator.clipboard.writeText(window.generatedResumeContent).then(() => {
                    showNotification(' Resume copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy resume:', err);
                    showNotification(' Failed to copy resume', 'error');
                });
            } else {
                showNotification(' No resume content to copy', 'error');
            }
        }
        
        // Copy Cover Letter to Clipboard
        function copyCoverLetterToClipboard() {
            if (window.generatedCoverLetterContent) {
                navigator.clipboard.writeText(window.generatedCoverLetterContent).then(() => {
                    showNotification(' Cover letter copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy cover letter:', err);
                    showNotification(' Failed to copy cover letter', 'error');
                });
            } else {
                showNotification(' No cover letter content to copy', 'error');
            }
        }
        
        // Fallback Word download using simple text formatting
        function downloadAsSimpleWord(content, filename) {
            try {
                // Create a Word-compatible HTML document
                const htmlContent = `
                    <!DOCTYPE html>
                    <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="ProgId" content="Word.Document">
                        <meta name="Generator" content="Microsoft Word 15">
                        <meta name="Originator" content="Microsoft Word 15">
                        <title>${filename}</title>
                        <style>
                            body { 
                                font-family: 'Calibri', 'Arial', sans-serif; 
                                margin: 40px; 
                                line-height: 1.6; 
                                font-size: 12pt;
                            }
                            h1 { 
                                color: #2c3e50; 
                                border-bottom: 2px solid #3498db; 
                                padding-bottom: 10px; 
                                font-size: 18pt;
                                margin-bottom: 20px;
                            }
                            p { 
                                margin: 10px 0; 
                                text-align: justify;
                            }
                            .document-title {
                                text-align: center;
                                font-size: 20pt;
                                font-weight: bold;
                                margin-bottom: 30px;
                                color: #2c3e50;
                            }
                        </style>
                    </head>
                    <body>
                        <div class="document-title">${filename.replace('.docx', '')}</div>
                        ${content.split('\n').filter(line => line.trim().length > 0).map(line => `<p>${line.trim()}</p>`).join('')}
                    </body>
                    </html>
                `;
                
                const blob = new Blob([htmlContent], { type: 'application/msword' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename.replace('.docx', '.doc');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                showNotification(' Downloaded as Word-compatible HTML (.doc)', 'success');
            } catch (error) {
                console.error('Error creating HTML document:', error);
                showNotification(' Error creating document', 'error');
            }
        }
        
        // Enhanced Word download with fallback
        function downloadResumeAsWordEnhanced() {
            if (!window.generatedResumeContent) {
                showNotification(' No resume content to download', 'error');
                return;
            }
            
            // Try the main Word download first
            try {
                downloadResumeAsWord();
            } catch (error) {
                console.log('Main Word download failed, trying fallback...');
                // Fallback to HTML format that Word can open
                downloadAsSimpleWord(window.generatedResumeContent, 'Professional_Resume.docx');
            }
        }
        
        function downloadCoverLetterAsWordEnhanced() {
            if (!window.generatedCoverLetterContent) {
                showNotification(' No cover letter content to download', 'error');
                return;
            }
            
            // Try the main Word download first
            try {
                downloadCoverLetterAsWord();
            } catch (error) {
                console.log('Main Word download failed, trying fallback...');
                // Fallback to HTML format that Word can open
                downloadAsSimpleWord(window.generatedCoverLetterContent, 'Cover_Letter.docx');
            }
        }
        
        // Interactive Interview System
        let interviewSession = {
            questions: [],
            currentQuestionIndex: 0,
            userAnswers: [],
            feedback: []
        };
        
        // Start interactive interview
        async function startInteractiveInterview() {
            const jobDescription = document.getElementById('interviewJobDescription').value.trim();
            
            if (!jobDescription) {
                showNotification(' Please enter a job description first', 'error');
                return;
            }
            
            // Show interview session
            document.getElementById('interviewSession').style.display = 'block';
            document.getElementById('interviewResult').style.display = 'none';
            
            // Generate questions
            try {
                const response = await fetch('/api/interview-prep', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jobDescription: jobDescription })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Prepare questions for interactive session
                    interviewSession.questions = [];
                    interviewSession.currentQuestionIndex = 0;
                    interviewSession.userAnswers = [];
                    interviewSession.feedback = [];
                    
                    // Combine all question types
                    if (data.result.behavioralQuestions) {
                        data.result.behavioralQuestions.forEach(q => {
                            interviewSession.questions.push({
                                ...q,
                                type: 'behavioral',
                                category: 'Teamwork & Communication'
                            });
                        });
                    }
                    
                    if (data.result.technicalQuestions) {
                        data.result.technicalQuestions.forEach(q => {
                            interviewSession.questions.push({
                                ...q,
                                type: 'technical',
                                category: 'Technical Skills'
                            });
                        });
                    }
                    
                    if (data.result.situationalQuestions) {
                        data.result.situationalQuestions.forEach(q => {
                            interviewSession.questions.push({
                                ...q,
                                type: 'situational',
                                category: 'Problem Solving'
                            });
                        });
                    }
                    
                    // Shuffle questions for variety
                    interviewSession.questions = shuffleArray(interviewSession.questions);
                    
                    // Limit to 5 questions for manageable session
                    interviewSession.questions = interviewSession.questions.slice(0, 5);
                    
                    // Start with first question
                    showCurrentQuestion();
                    
                    showNotification(' Question-by-question interview started! Answer all questions to receive comprehensive feedback at the end.', 'success');
                } else {
                    showNotification(' Failed to generate interview questions: ' + (data.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error starting interview:', error);
                showNotification(' Error starting interview: ' + error.message, 'error');
            }
        }
        
        // Show current question
        function showCurrentQuestion() {
            if (interviewSession.currentQuestionIndex >= interviewSession.questions.length) {
                completeInterview();
                return;
            }
            
            const question = interviewSession.questions[interviewSession.currentQuestionIndex];
            
            // Update question display with null checks
            const questionText = document.getElementById('questionText');
            const questionFocus = document.getElementById('questionFocus');
            const questionTip = document.getElementById('questionTip');
            const progressFill = document.getElementById('progressFill');
            const questionCounter = document.getElementById('questionCounter');
            const userAnswer = document.getElementById('userAnswer');
            const currentQuestionSection = document.querySelector('.current-question-section');
            
            if (questionText) questionText.textContent = question.question;
            if (questionFocus) questionFocus.textContent = `Focus: ${question.focus || 'General'}`;
            if (questionTip) questionTip.textContent = `Tip: ${question.tip || 'Think about your experience and provide specific examples'}`;
            
            // Update progress
            if (progressFill && questionCounter) {
                const progress = ((interviewSession.currentQuestionIndex + 1) / interviewSession.questions.length) * 100;
                progressFill.style.width = progress + '%';
                questionCounter.textContent = `Question ${interviewSession.currentQuestionIndex + 1} of ${interviewSession.questions.length}`;
            }
            
            // Clear previous answer
            if (userAnswer) userAnswer.value = '';
            
            // Show question section
            if (currentQuestionSection) currentQuestionSection.style.display = 'block';
            
            // Speak the question
            speakText(question.question, 'interview');
        }
        
        // Submit answer and get feedback
        async function submitAnswer() {
            const answer = document.getElementById('userAnswer').value.trim();
            
            if (!answer) {
                showNotification(' Please provide an answer before submitting', 'error');
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitAnswerBtn');
            const submitBtnText = document.getElementById('submitBtnText');
            const submitBtnLoading = document.getElementById('submitBtnLoading');
            
            submitBtn.disabled = true;
            submitBtnText.style.display = 'none';
            submitBtnLoading.style.display = 'inline';
            
            try {
                const currentQuestion = interviewSession.questions[interviewSession.currentQuestionIndex];
                
                // Store user answer
                interviewSession.userAnswers.push({
                    question: currentQuestion.question,
                    answer: answer,
                    type: currentQuestion.type,
                    category: currentQuestion.category
                });
                
                // Clear the answer input
                document.getElementById('userAnswer').value = '';
                
                // Move to next question
                nextQuestion();
                
                showNotification(' Answer saved! Moving to next question...', 'success');
            } catch (error) {
                console.error('Error submitting answer:', error);
                showNotification(' Error saving answer. Please try again.', 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitBtnText.style.display = 'inline';
                submitBtnLoading.style.display = 'none';
            }
        }
        
        // Skip current question
        function skipQuestion() {
            const currentQuestion = interviewSession.questions[interviewSession.currentQuestionIndex];
            
            // Store skipped question
            interviewSession.userAnswers.push({
                question: currentQuestion.question,
                answer: 'Skipped',
                type: currentQuestion.type,
                category: currentQuestion.category
            });
            
            // Move to next question
            nextQuestion();
            
            showNotification(' Question skipped. Moving to next question...', 'info');
        }
        
        // Move to next question
        function nextQuestion() {
            interviewSession.currentQuestionIndex++;
            showCurrentQuestion();
        }
        
        // Complete interview and show final feedback
        async function completeInterview() {
            document.querySelector('.current-question-section').style.display = 'none';
            
            // Show loading state for final feedback
            document.getElementById('finalFeedback').innerHTML = '<div class="loading-feedback"> Generating comprehensive feedback for all your answers...</div>';
            document.getElementById('interviewComplete').style.display = 'block';
            
            try {
                // Generate comprehensive feedback for all answers
                await generateComprehensiveFeedback();
                
                // Generate final evaluation with comprehensive feedback
                const finalEvaluation = generateFinalEvaluation();
                document.getElementById('finalFeedback').innerHTML = finalEvaluation;
                
                showNotification(' Interview complete! Review your comprehensive feedback and areas for development.', 'success');
            } catch (error) {
                console.error('Error completing interview:', error);
                document.getElementById('finalFeedback').innerHTML = '<div class="error-feedback"> Error generating feedback. Please try again.</div>';
                showNotification(' Error generating feedback. Please try again.', 'error');
            }
        }
        
        // Generate comprehensive feedback for all answers
        async function generateComprehensiveFeedback() {
            try {
                // Prepare all questions and answers for comprehensive feedback
                const feedbackData = interviewSession.userAnswers.map(qa => ({
                    question: qa.question,
                    answer: qa.answer,
                    type: qa.type,
                    category: qa.category
                }));
                
                const feedbackPrompt = `I'm reviewing my interview practice session. Here are my questions and answers:

${feedbackData.map((qa, index) => `${index + 1}. Question: "${qa.question}" (Type: ${qa.type}, Focus: ${qa.category})
   My Answer: "${qa.answer}"`).join('\n\n')}

Please provide comprehensive feedback including:
1. Overall performance assessment
2. Strengths in my answers
3. Areas for improvement
4. Specific development recommendations
5. Tips for future interviews

Keep feedback constructive and actionable.`;

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: feedbackPrompt })
                });
                
                const data = await response.json();
                
                if (data.success && data.result) {
                    // Store comprehensive feedback
                    interviewSession.comprehensiveFeedback = data.result;
                } else {
                    interviewSession.comprehensiveFeedback = {
                        answer: "Comprehensive feedback could not be generated. Review your answers and identify areas for improvement."
                    };
                }
            } catch (error) {
                console.error('Error generating comprehensive feedback:', error);
                interviewSession.comprehensiveFeedback = {
                    answer: "Comprehensive feedback could not be generated due to an error."
                };
            }
        }

        // Generate final evaluation
        function generateFinalEvaluation() {
            let html = '<div class="final-evaluation">';
            
            // Summary
            html += '<h5> Interview Summary</h5>';
            html += `<p>You answered ${interviewSession.userAnswers.filter(a => a.answer !== 'Skipped').length} out of ${interviewSession.questions.length} questions.</p>`;
            
            // Question breakdown
            html += '<h5> Question Breakdown</h5>';
            interviewSession.userAnswers.forEach((answer, index) => {
                html += `
                    <div class="answer-review">
                        <h6>Question ${index + 1}: ${answer.question}</h6>
                        <p><strong>Type:</strong> ${answer.type} | <strong>Focus:</strong> ${answer.category}</p>
                        <p><strong>Your Answer:</strong> ${answer.answer}</p>
                    </div>
                `;
            });
            
            // Comprehensive feedback
            if (interviewSession.comprehensiveFeedback) {
                html += '<h5> Comprehensive Feedback & Development Areas</h5>';
                html += '<div class="comprehensive-feedback">';
                if (typeof interviewSession.comprehensiveFeedback === 'string') {
                    html += `<p>${interviewSession.comprehensiveFeedback}</p>`;
                } else {
                    html += formatChatResponse(interviewSession.comprehensiveFeedback);
                }
                html += '</div>';
            }
            
            // Overall assessment
            html += '<h5> Overall Assessment</h5>';
            const answeredQuestions = interviewSession.userAnswers.filter(a => a.answer !== 'Skipped').length;
            const totalQuestions = interviewSession.questions.length;
            
            if (answeredQuestions === totalQuestions) {
                html += '<p> Excellent! You answered all questions. Review the feedback above to identify areas for improvement.</p>';
            } else if (answeredQuestions >= totalQuestions * 0.8) {
                html += '<p> Good job! You answered most questions. Focus on the areas you skipped and review the feedback.</p>';
            } else {
                html += '<p> You\'re getting started! Practice more to build confidence in answering all types of questions.</p>';
            }
            
            html += '</div>';
            return html;
        }
        
        // Restart interview
        function restartInterview() {
            interviewSession = {
                questions: [],
                currentQuestionIndex: 0,
                userAnswers: [],
                feedback: [],
                comprehensiveFeedback: null
            };
            
            document.getElementById('interviewSession').style.display = 'none';
            document.getElementById('interviewResult').style.display = 'none';
            
            showNotification(' Interview reset. Click "Start Question-by-Question Interview" to begin again.', 'info');
        }
        
        // Utility function to shuffle array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        
        // Force browser to reload JavaScript (cache busting)
        console.log('AI Career Coach loaded at:', new Date().toISOString());
        
        // Authentication functions
        let currentUser = null;
        let authToken = null;
        
        // Check if user is already logged in
        function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            if (token) {
                authToken = token;
                // Verify token and show main app
                verifyTokenAndShowApp();
            } else {
                showAuthSection();
            }
        }
        
        function showAuthSection() {
            document.getElementById('authSection').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }
        
        function showMainApp() {
            document.getElementById('authSection').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Show loading state
            const loginBtn = document.querySelector('#loginForm button[type="submit"]');
            const originalText = loginBtn.textContent;
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading-spinner" style="width: 20px; height: 20px; margin-right: 10px;"></span>Logging in...';
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('userData', JSON.stringify(currentUser));
                    
                    showMainApp();
                    document.getElementById('userEmail').textContent = currentUser.email;
                    showNotification(' Login successful!', 'success');
                } else {
                    showNotification(' ' + data.error, 'error');
                }
            } catch (error) {
                showNotification(' Login failed: ' + error.message, 'error');
            } finally {
                // Reset button state
                loginBtn.disabled = false;
                loginBtn.textContent = originalText;
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                showNotification(' Passwords do not match', 'error');
                return;
            }
            
            // Show loading state
            const registerBtn = document.querySelector('#registerForm button[type="submit"]');
            const originalText = registerBtn.textContent;
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<span class="loading-spinner" style="width: 20px; height: 20px; margin-right: 10px;"></span>Creating account...';
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, password })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentUser = data.user;
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('userData', JSON.stringify(currentUser));
                    
                    showMainApp();
                    document.getElementById('userEmail').textContent = currentUser.email;
                    showNotification(' Registration successful!', 'success');
                } else {
                    showNotification(' ' + data.error, 'error');
                }
            } catch (error) {
                showNotification(' Registration failed: ' + error.message, 'error');
            } finally {
                // Reset button state
                registerBtn.disabled = false;
                registerBtn.textContent = originalText;
            }
        }
        
        function logout() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            showAuthSection();
            showNotification(' Logged out successfully', 'info');
        }
        
        function showRegisterForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }
        
        function showLoginForm() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        }
        
        async function verifyTokenAndShowApp() {
            try {
                const response = await fetch('/api/profile', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    showMainApp();
                    document.getElementById('userEmail').textContent = currentUser.email;
                } else {
                    // Token invalid, clear and show auth
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userData');
                    showAuthSection();
                }
            } catch (error) {
                showAuthSection();
            }
        }
        
        // Test voice capabilities on page load
        function testVoiceCapabilities() {
            console.log('Testing voice capabilities...');
            console.log('Device type:', isMobileDevice ? 'Mobile' : 'Desktop');
            console.log('Speech recognition support:', 'webkitSpeechRecognition' in window ? 'Yes' : 'No');
            console.log('Media devices support:', navigator.mediaDevices ? 'Yes' : 'No');
            
            // Initialize voice recognition if supported
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                initializeVoiceRecognition();
                console.log('Voice recognition initialized successfully');
            } else {
                console.log('Voice recognition not supported');
            }
        }
        
        // Run voice capability test when page loads
        document.addEventListener('DOMContentLoaded', function() {
            testVoiceCapabilities();
            checkAuthStatus(); // Check authentication status
            
            // Add event listeners for authentication navigation
            const showRegisterLink = document.getElementById('showRegisterLink');
            const showLoginLink = document.getElementById('showLoginLink');
            
            if (showRegisterLink) {
                showRegisterLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showRegisterForm();
                });
            }
            
            if (showLoginLink) {
                showLoginLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    showLoginForm();
                });
            }
        });

        // Add missing functions that are referenced but not defined
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        function updateVoiceUI(isRecording) {
            const voiceButtons = document.querySelectorAll('.voice-btn');
            voiceButtons.forEach(btn => {
                if (isRecording) {
                    btn.innerHTML = ' Stop';
                    btn.classList.add('recording');
                } else {
                    btn.innerHTML = ' Start Voice Input';
                    btn.classList.remove('recording');
                }
            });
        }

        function updateVoiceInput(transcript) {
            // Find the appropriate input field based on current voice mode
            let targetInput = null;
            
            switch (currentVoiceMode) {
                case 'chat':
                    targetInput = document.getElementById('userMessage');
                    break;
                case 'resume':
                    targetInput = document.getElementById('jobDescription');
                    break;
                case 'coverLetter':
                    targetInput = document.getElementById('coverLetterJobDesc');
                    break;
                case 'interview':
                    targetInput = document.getElementById('interviewJobDesc');
                    break;
                case 'career':
                    targetInput = document.getElementById('careerGoals');
                    break;
                case 'analytics':
                    targetInput = document.getElementById('analyticsQuery');
                    break;
                case 'jobSearch':
                    targetInput = document.getElementById('jobTitle');
                    break;
            }
            
            if (targetInput) {
                targetInput.value = transcript;
                targetInput.focus();
            }
        }

        function handleVoiceError(error) {
            console.error('Voice recognition error:', error);
            let errorMessage = 'Voice recognition error occurred';
            
            switch (error) {
                case 'no-speech':
                    errorMessage = 'No speech detected. Please try again.';
                    break;
                case 'audio-capture':
                    errorMessage = 'Microphone access denied. Please check permissions.';
                    break;
                case 'not-allowed':
                    errorMessage = 'Microphone access denied. Please allow microphone access.';
                    break;
                case 'network':
                    errorMessage = 'Network error. Please check your connection.';
                    break;
            }
            
            showNotification(' ' + errorMessage, 'error');
        }

        function requestMicrophonePermission() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(function(stream) {
                        console.log('Microphone permission granted');
                        stream.getTracks().forEach(track => track.stop());
                    })
                    .catch(function(err) {
                        console.log('Microphone permission denied:', err);
                        showNotification(' Microphone access denied. Please enable microphone permissions.', 'error');
                    });
            }
        }

        function showMobileVoiceFallback() {
            console.log('Showing mobile voice fallback');
            // For mobile devices without speech recognition, show a message
            showNotification(' Voice input not supported on this device. Please use text input.', 'info');
        }

        function stopVoiceInput() {
            if (recognition && isRecording) {
                recognition.stop();
            }
        }

        function stopSpeaking() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
        }

        function speakText(text) {
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }
    </script>
</div> <!-- Close mainApp div -->
</body>
</html>
